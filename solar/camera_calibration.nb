(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    145747,       4067]
NotebookOptionsPosition[    135514,       3892]
NotebookOutlinePosition[    135932,       3908]
CellTagsIndexPosition[    135889,       3905]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Direct Linear Transform", "Section",ExpressionUUID->"561c775e-c42c-462e-876e-a8fca401d9b5"],

Cell[CellGroupData[{

Cell["Equation", "Subsection",ExpressionUUID->"62375e9d-8d93-422f-8995-3699321aa997"],

Cell[BoxData[{
 RowBox[{
  SubscriptBox["\[DoubleStruckCapitalZ]", "n_"], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{
    RowBox[{"{", "0", "}"}], ",", 
    RowBox[{"{", "n", "}"}]}], "]"}]}], "\n", 
 RowBox[{
  SubscriptBox["\[DoubleStruckCapitalZ]", 
   RowBox[{"n_", ",", "m_"}]], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "m"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  SubscriptBox["\[DoubleStruckCapitalO]", "n_"], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{
    RowBox[{"{", "1", "}"}], ",", 
    RowBox[{"{", "n", "}"}]}], "]"}]}], "\n", 
 RowBox[{
  SubscriptBox["\[DoubleStruckCapitalO]", 
   RowBox[{"n_", ",", "m_"}]], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"1", ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "m"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  SubscriptBox["P", 
   RowBox[{"n_", ",", "m_"}]], ":=", 
  RowBox[{"Array", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Subscript", "[", 
      RowBox[{"p", ",", " ", "##"}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "m"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[CapitalIota]", "n_"], ":=", 
   RowBox[{"IdentityMatrix", "[", "n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"AngleBracket", "[", "mat_", "]"}], ":=", 
  RowBox[{"ArrayFlatten", "[", "mat", "]"}]}], "\n", 
 RowBox[{
  SubscriptBox["v_List", "H"], ":=", 
  RowBox[{"v", "//", 
   RowBox[{"Append", "@", 
    RowBox[{"{", "1", "}"}]}]}]}], "\n", 
 RowBox[{
  SubscriptBox["v_List", "e"], ":=", 
  RowBox[{
   RowBox[{"Most", "@", "v"}], "/", 
   RowBox[{"First", "@", 
    RowBox[{"Last", "@", "v"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Unlist", "[", "ls_", "]"}], ":=", 
   RowBox[{"Replace", "[", 
    RowBox[{"ls", ",", 
     RowBox[{
      RowBox[{"{", "x_", "}"}], "->", "x"}], ",", "2"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"vec", "[", "v_", "]"}], ":=", 
  RowBox[{"v", "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.8956602173606606`*^9, 3.895660316484296*^9}, {
  3.8956603505734577`*^9, 3.8956603772630415`*^9}},
 CellLabel->
  "In[315]:=",ExpressionUUID->"2b19e1db-74ed-4af5-a399-f5cad55e88b8"],

Cell[CellGroupData[{

Cell["Definitions", "Subsubsection",ExpressionUUID->"cc30baeb-0c25-44c8-8628-2b3ecd0ff798"],

Cell[TextData[{
 " Intrinsic matrix K:\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"K", "=", 
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        SubscriptBox["\[ScriptF]", "x"], "\[ScriptS]", 
        SubscriptBox["\[ScriptX]", "0"]},
       {"0", 
        SubscriptBox["\[ScriptF]", "y"], 
        SubscriptBox["\[ScriptY]", "0"]},
       {"0", "0", "1"}
      },
      GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}}], "\[NoBreak]", ")"}]}], TraditionalForm]],
  ExpressionUUID->"1ef10635-d8fb-459d-aadf-d53d1120bd36"],
 "\nwhere:\n\[ScriptF] - focal lengths of the camera in terms of pixel\n\
dimensions\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    SubscriptBox["\[ScriptX]", "0"]}], TraditionalForm]],ExpressionUUID->
  "72547b7f-7e66-47b2-9ecf-f705cc121be8"],
 ", ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[ScriptY]", "0"], TraditionalForm]],ExpressionUUID->
  "f638bbc8-6f32-4c33-8dfc-f5fce15679a6"],
 ") - principal point on the image plane (image center)\n\[ScriptS] - skew \
parameter\nLinks:\n",
 ButtonBox["principal point",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://catalyst.earth/catalyst-system-files/help/concepts/\
orthoengine_c/Chapter_45.html"], None},
  ButtonNote->
   "https://catalyst.earth/catalyst-system-files/help/concepts/orthoengine_c/\
Chapter_45.html"],
 "\n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"R", "=", 
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        SubscriptBox["r", 
         RowBox[{"1", ",", "1"}]], 
        SubscriptBox["r", 
         RowBox[{"1", ",", "2"}]], 
        SubscriptBox["r", 
         RowBox[{"1", ",", "3"}]]},
       {
        SubscriptBox["r", 
         RowBox[{"2", ",", "1"}]], 
        SubscriptBox["r", 
         RowBox[{"2", ",", "2"}]], 
        SubscriptBox["r", 
         RowBox[{"2", ",", "3"}]]},
       {
        SubscriptBox["r", 
         RowBox[{"3", ",", "1"}]], 
        SubscriptBox["r", 
         RowBox[{"3", ",", "2"}]], 
        SubscriptBox["r", 
         RowBox[{"3", ",", "3"}]]}
      },
      GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}}], "\[NoBreak]", ")"}]}], TraditionalForm]],
  ExpressionUUID->"3870e4e2-af51-4f56-8aeb-b742392a13fc"],
 "\nrotations ",
 Cell[BoxData[
  FormBox[
   RowBox[{"R", " ", "=", " ", 
    RowBox[{
     SubscriptBox["R", "x"], 
     SubscriptBox["R", "y"], 
     SubscriptBox["R", "z"]}]}], TraditionalForm]],ExpressionUUID->
  "a6107104-8d2b-4183-a253-002ffd03dcbb"],
 " \n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["X", "0"], "=", 
    RowBox[{"(", GridBox[{
       {
        SubscriptBox["t", "1"]},
       {
        SubscriptBox["t", "2"]},
       {
        SubscriptBox["t", "3"]}
      }], ")"}]}], TraditionalForm]],ExpressionUUID->
  "18ba5190-caad-48eb-97d4-16fd3533eeea"],
 "\ntranslation and also camera location"
}], "Text",
 CellChangeTimes->{{3.8956595267933903`*^9, 3.8956595349555225`*^9}, {
  3.8956604116477566`*^9, 3.8956604290818577`*^9}, {3.895660536620338*^9, 
  3.895660559550708*^9}, {3.895660656547839*^9, 3.8956607890088377`*^9}, {
  3.8956725285048704`*^9, 
  3.8956725285068655`*^9}},ExpressionUUID->"2f63ad15-4a5a-4c99-85b2-\
fb4d557a18cc"],

Cell["Full transformation", "Text",ExpressionUUID->"d645b441-9d00-47ca-b6d2-e7e6599f122d"],

Cell[TextData[{
 " ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["x", "image"], "=", 
      RowBox[{
       RowBox[{"K", ".", "R", ".", 
        FormBox[
         RowBox[{"[", 
          SubscriptBox["I", "3"]}],
         TraditionalForm]}], " ", 
       FormBox[
        SubscriptBox["X", "0"],
        TraditionalForm]}]}], "]"}], ".", 
    FormBox[
     SubscriptBox["X", "world"],
     TraditionalForm]}], TraditionalForm]],ExpressionUUID->
  "589d2745-7e27-4715-bae3-98de514140be"],
 "\n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"(", GridBox[{
       {"x"},
       {"y"},
       {"1"}
      }], ")"}], "=", 
    RowBox[{
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["\[ScriptF]", "x"], "\[ScriptS]", 
         SubscriptBox["\[ScriptX]", "0"]},
        {"0", 
         SubscriptBox["\[ScriptF]", "y"], 
         SubscriptBox["\[ScriptY]", "0"]},
        {"0", "0", "1"}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}], 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["r", 
          RowBox[{"1", ",", "1"}]], 
         SubscriptBox["r", 
          RowBox[{"1", ",", "2"}]], 
         SubscriptBox["r", 
          RowBox[{"1", ",", "3"}]]},
        {
         SubscriptBox["r", 
          RowBox[{"2", ",", "1"}]], 
         SubscriptBox["r", 
          RowBox[{"2", ",", "2"}]], 
         SubscriptBox["r", 
          RowBox[{"2", ",", "3"}]]},
        {
         SubscriptBox["r", 
          RowBox[{"3", ",", "1"}]], 
         SubscriptBox["r", 
          RowBox[{"3", ",", "2"}]], 
         SubscriptBox["r", 
          RowBox[{"3", ",", "3"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}], 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {"1", "0", "0", 
         RowBox[{"-", 
          SubscriptBox["t", "1"]}]},
        {"0", "1", "0", 
         RowBox[{"-", 
          SubscriptBox["t", "2"]}]},
        {"0", "0", "1", 
         RowBox[{"-", 
          SubscriptBox["t", "3"]}]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}], 
     RowBox[{"(", GridBox[{
        {"X"},
        {"Y"},
        {"Z"},
        {"1"}
       }], ")"}]}]}], TraditionalForm]],ExpressionUUID->
  "e83a005e-c324-496f-a90e-b4c64b83bd54"],
 "\n"
}], "Text",
 CellChangeTimes->{{3.895660850421258*^9, 3.895660911710142*^9}, {
   3.895661009327565*^9, 3.895661025786401*^9}, {3.895661056193079*^9, 
   3.8956610895487165`*^9}, {3.895661132847699*^9, 3.895661220125432*^9}, 
   3.8956612516222343`*^9},ExpressionUUID->"0fa720d2-1ce4-4230-90c8-\
327b5ce252f2"],

Cell["set all unknowns to P", "Text",ExpressionUUID->"eafecef0-8f8b-4a20-9edd-383370317d1d"],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"P", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {
          SubscriptBox["\[ScriptF]", "x"], "\[ScriptS]", 
          SubscriptBox["\[ScriptX]", "0"]},
         {"0", 
          SubscriptBox["\[ScriptF]", "y"], 
          SubscriptBox["\[ScriptY]", "0"]},
         {"0", "0", "1"}
        },
        GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
        GridBoxSpacings->{"Columns" -> {
            Offset[0.27999999999999997`], {
             Offset[0.7]}, 
            Offset[0.27999999999999997`]}, "Rows" -> {
            Offset[0.2], {
             Offset[0.4]}, 
            Offset[0.2]}}], "\[NoBreak]", ")"}], 
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {
          SubscriptBox["r", 
           RowBox[{"1", ",", "1"}]], 
          SubscriptBox["r", 
           RowBox[{"1", ",", "2"}]], 
          SubscriptBox["r", 
           RowBox[{"1", ",", "3"}]]},
         {
          SubscriptBox["r", 
           RowBox[{"2", ",", "1"}]], 
          SubscriptBox["r", 
           RowBox[{"2", ",", "2"}]], 
          SubscriptBox["r", 
           RowBox[{"2", ",", "3"}]]},
         {
          SubscriptBox["r", 
           RowBox[{"3", ",", "1"}]], 
          SubscriptBox["r", 
           RowBox[{"3", ",", "2"}]], 
          SubscriptBox["r", 
           RowBox[{"3", ",", "3"}]]}
        },
        GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
        GridBoxSpacings->{"Columns" -> {
            Offset[0.27999999999999997`], {
             Offset[0.7]}, 
            Offset[0.27999999999999997`]}, "Rows" -> {
            Offset[0.2], {
             Offset[0.4]}, 
            Offset[0.2]}}], "\[NoBreak]", ")"}], 
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"1", "0", "0", 
          RowBox[{"-", 
           SubscriptBox["t", "1"]}]},
         {"0", "1", "0", 
          RowBox[{"-", 
           SubscriptBox["t", "2"]}]},
         {"0", "0", "1", 
          RowBox[{"-", 
           SubscriptBox["t", "3"]}]}
        },
        GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
        GridBoxSpacings->{"Columns" -> {
            Offset[0.27999999999999997`], {
             Offset[0.7]}, 
            Offset[0.27999999999999997`]}, "Rows" -> {
            Offset[0.2], {
             Offset[0.4]}, 
            Offset[0.2]}}], "\[NoBreak]", ")"}]}], "=", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "2"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "3"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "4"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "2"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "3"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "4"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "2"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "3"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}]}]}], TraditionalForm]],
  ExpressionUUID->"ed171b26-62e2-47ff-bd43-0e135c83d0c6"],
 "\n"
}], "Text",
 CellChangeTimes->{{3.895661286658802*^9, 3.8956613223534193`*^9}, {
  3.8956614027952175`*^9, 
  3.895661427677189*^9}},ExpressionUUID->"45926a3f-4539-4184-aa8e-\
ed7bbe7b57c4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solution", "Subsubsection",ExpressionUUID->"caff42f6-3568-4329-b01f-ee4c970b2fb1"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[DoubleStruckX]", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"x"},
      {"y"}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], ";", 
  RowBox[{"\[DoubleStruckCapitalX]", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"X"},
      {"Y"},
      {"Z"}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], ";", 
  RowBox[{
   SubscriptBox["\[DoubleStruckCapitalT]", "0"], "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {
       SubscriptBox["t", "1"]},
      {
       SubscriptBox["t", "2"]},
      {
       SubscriptBox["t", "3"]}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[LeftAngleBracket]", GridBox[{
    {
     SubscriptBox["\[CapitalIota]", "3"], 
     SubscriptBox["\[DoubleStruckCapitalT]", "0"]}
   }], "\[RightAngleBracket]"}]}], "Input",
 InitializationCell->False,
 CellChangeTimes->{{3.8956614640537505`*^9, 3.895661506277919*^9}, {
  3.895661546281436*^9, 3.89566164226272*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"328a2fa2-5980-4c4d-b661-eb8352852473"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1", "0", "0", 
      SubscriptBox["t", "1"]},
     {"0", "1", "0", 
      SubscriptBox["t", "2"]},
     {"0", "0", "1", 
      SubscriptBox["t", "3"]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.8956616485095243`*^9, 3.8956672142703786`*^9},
 CellLabel->"Out[40]=",ExpressionUUID->"a7e473c2-5a49-463a-8b4b-fc1f279b6186"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[DoubleStruckX]", "==", 
     SubscriptBox[
      RowBox[{"(", 
       RowBox[{
        SubscriptBox["P", 
         RowBox[{"3", ",", "4"}]], ".", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}], ")"}], "e"]}], "//", 
    "Thread"}], "//", "Unlist"}], "//", "Column"}]], "Input",
 CellChangeTimes->{{3.8956616580003724`*^9, 3.895661733579962*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"4b36600d-05e2-4213-a7ad-b6f0eca85a1e"],

Cell[BoxData[
 FormBox[
  TagBox[GridBox[{
     {
      RowBox[{"x", "\[LongEqual]", 
       FractionBox[
        RowBox[{
         RowBox[{"X", " ", 
          SubscriptBox["p", 
           RowBox[{"1", ",", "1"}]]}], "+", 
         RowBox[{"Y", " ", 
          SubscriptBox["p", 
           RowBox[{"1", ",", "2"}]]}], "+", 
         RowBox[{"Z", " ", 
          SubscriptBox["p", 
           RowBox[{"1", ",", "3"}]]}], "+", 
         SubscriptBox["p", 
          RowBox[{"1", ",", "4"}]]}], 
        RowBox[{
         RowBox[{"X", " ", 
          SubscriptBox["p", 
           RowBox[{"3", ",", "1"}]]}], "+", 
         RowBox[{"Y", " ", 
          SubscriptBox["p", 
           RowBox[{"3", ",", "2"}]]}], "+", 
         RowBox[{"Z", " ", 
          SubscriptBox["p", 
           RowBox[{"3", ",", "3"}]]}], "+", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}]]}]},
     {
      RowBox[{"y", "\[LongEqual]", 
       FractionBox[
        RowBox[{
         RowBox[{"X", " ", 
          SubscriptBox["p", 
           RowBox[{"2", ",", "1"}]]}], "+", 
         RowBox[{"Y", " ", 
          SubscriptBox["p", 
           RowBox[{"2", ",", "2"}]]}], "+", 
         RowBox[{"Z", " ", 
          SubscriptBox["p", 
           RowBox[{"2", ",", "3"}]]}], "+", 
         SubscriptBox["p", 
          RowBox[{"2", ",", "4"}]]}], 
        RowBox[{
         RowBox[{"X", " ", 
          SubscriptBox["p", 
           RowBox[{"3", ",", "1"}]]}], "+", 
         RowBox[{"Y", " ", 
          SubscriptBox["p", 
           RowBox[{"3", ",", "2"}]]}], "+", 
         RowBox[{"Z", " ", 
          SubscriptBox["p", 
           RowBox[{"3", ",", "3"}]]}], "+", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}]]}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], TraditionalForm]], "Output",
 CellChangeTimes->{{3.8956616802321205`*^9, 3.8956616949302373`*^9}, 
   3.895661735699282*^9},
 CellLabel->"Out[96]=",ExpressionUUID->"32ff4376-dbfd-4c04-90a4-84b20171f36b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearAll", "[", 
  RowBox[{
  "\[DoubleStruckCapitalA]", ",", "\[DoubleStruckCapitalB]", ",", 
   "\[DoubleStruckCapitalC]"}], "]"}], "\n", 
 RowBox[{
  RowBox[{
  "\[DoubleStruckCapitalA]\[DoubleStruckCapitalB]\[DoubleStruckCapitalC]", 
   "=", 
   RowBox[{"{", 
    RowBox[{
    "\[DoubleStruckCapitalA]", ",", "\[DoubleStruckCapitalB]", ",", 
     "\[DoubleStruckCapitalC]"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[DoubleStruckCapitalA]", "1"], ",", 
     SubscriptBox["\[DoubleStruckCapitalB]", "1"], ",", 
     SubscriptBox["\[DoubleStruckCapitalC]", "1"]}], "}"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"List", "/@", 
      RowBox[{
       SubscriptBox["P", 
        RowBox[{"3", ",", "4"}]], "[", 
       RowBox[{"[", 
        RowBox[{"#", ",", "All"}], "]"}], "]"}]}], "&"}], "/@", 
    RowBox[{"Range", "@", "3"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"\[DoubleStruckCapitalA]", "->", 
    SubscriptBox["\[DoubleStruckCapitalA]", "1"]}], ",", 
   RowBox[{"\[DoubleStruckCapitalB]", "->", 
    SubscriptBox["\[DoubleStruckCapitalB]", "1"]}], ",", 
   RowBox[{"\[DoubleStruckCapitalC]", "->", 
    SubscriptBox["\[DoubleStruckCapitalC]", "1"]}]}], "}"}]}], "Input",
 CellChangeTimes->{
  3.895661784414113*^9, {3.89566274366686*^9, 3.8956628209223084`*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"55bd793d-9a01-4248-8765-3e6d5bfc060f"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalA]", "\[Rule]", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "1"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "2"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "3"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "4"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}]}], ",", 
    RowBox[{"\[DoubleStruckCapitalB]", "\[Rule]", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "1"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "2"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "3"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "4"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}]}], ",", 
    RowBox[{"\[DoubleStruckCapitalC]", "\[Rule]", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "1"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "2"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "3"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}]}]}], "}"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{3.8956617951085978`*^9, 3.895662832581188*^9, 
  3.895667185993883*^9},
 CellLabel->"Out[35]=",ExpressionUUID->"ece4755f-57c2-466b-b808-a0f317ccb06a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{
   "\[DoubleStruckCapitalA]", ",", "\[DoubleStruckCapitalB]", ",", 
    "\[DoubleStruckCapitalC]"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"x"},
     {"y"},
     {"w"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], "==", 
  RowBox[{
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {
       TemplateBox[{"\[DoubleStruckCapitalA]"},
        "Transpose"]},
      {
       TemplateBox[{"\[DoubleStruckCapitalB]"},
        "Transpose"]},
      {
       TemplateBox[{"\[DoubleStruckCapitalC]"},
        "Transpose"]}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}], "*", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {
       SubscriptBox["X", "1"]},
      {
       SubscriptBox["X", "2"]},
      {
       SubscriptBox["X", "3"]}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}]}]}], "Input",
 CellChangeTimes->{
  3.8956618243175063`*^9, {3.8956618582061768`*^9, 3.895661875171542*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"3e0f24ac-f0a7-42c2-b80c-fcbfa6786400"],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"x"},
      {"y"},
      {"w"}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}], "\[LongEqual]", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {
       RowBox[{
        SubscriptBox["X", "1"], " ", 
        TemplateBox[{"\[DoubleStruckCapitalA]"},
         "Transpose"]}]},
      {
       RowBox[{
        SubscriptBox["X", "2"], " ", 
        TemplateBox[{"\[DoubleStruckCapitalB]"},
         "Transpose"]}]},
      {
       RowBox[{
        SubscriptBox["X", "3"], " ", 
        TemplateBox[{"\[DoubleStruckCapitalC]"},
         "Transpose"]}]}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], TraditionalForm]], "Output",
 CellChangeTimes->{3.8956618789370584`*^9},
 CellLabel->
  "Out[105]=",ExpressionUUID->"ac8ceb3f-930b-47ca-91e6-d723dd83fca6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[DoubleStruckX]", "==", 
     SubscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {
            TemplateBox[{"\[DoubleStruckCapitalA]"},
             "Transpose"]},
           {
            TemplateBox[{"\[DoubleStruckCapitalB]"},
             "Transpose"]},
           {
            TemplateBox[{"\[DoubleStruckCapitalC]"},
             "Transpose"]}
          },
          GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}}], "\[NoBreak]", ")"}], "*", 
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {
            SubscriptBox["X", "1"]},
           {
            SubscriptBox["X", "2"]},
           {
            SubscriptBox["X", "3"]}
          },
          GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}}], "\[NoBreak]", ")"}]}], ")"}], "e"]}], "//", 
    "Thread"}], "//", "Unlist"}], "//", "Column"}]], "Input",
 CellChangeTimes->{{3.8956619507719145`*^9, 3.89566199992787*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"ed8a98e2-c6fa-4910-8466-f0cbf610c11c"],

Cell[BoxData[
 FormBox[
  TagBox[GridBox[{
     {
      RowBox[{"x", "\[LongEqual]", 
       FractionBox[
        RowBox[{
         SubscriptBox["X", "1"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalA]"},
          "Transpose"]}], 
        RowBox[{
         SubscriptBox["X", "3"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalC]"},
          "Transpose"]}]]}]},
     {
      RowBox[{"y", "\[LongEqual]", 
       FractionBox[
        RowBox[{
         SubscriptBox["X", "2"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalB]"},
          "Transpose"]}], 
        RowBox[{
         SubscriptBox["X", "3"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalC]"},
          "Transpose"]}]]}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], TraditionalForm]], "Output",
 CellChangeTimes->{3.8956620035837507`*^9},
 CellLabel->
  "Out[108]=",ExpressionUUID->"5192bf2c-70e5-4ac3-9dd4-6b691f924d4e"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"BalanceSides", "[", "eq_Equal", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"den", ",", "res"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"den", "=", 
      RowBox[{"Denominator", "/@", 
       RowBox[{"List", "@@", "eq"}]}]}], ";", "\n", 
     RowBox[{"den", "=", 
      RowBox[{
       RowBox[{"SelectFirst", "[", 
        RowBox[{
         RowBox[{"#", "=!=", "1"}], "&"}], "]"}], "@", "den"}]}], ";", "\n", 
     RowBox[{"res", "=", 
      RowBox[{"MultiplySides", "[", 
       RowBox[{"eq", ",", "den", ",", 
        RowBox[{"Assumptions", " ", "->", " ", 
         RowBox[{"den", " ", "!=", " ", "0"}]}]}], "]"}]}], ";", "\n", 
     RowBox[{"SubtractSides", "@", "res"}]}]}], "\n", "]"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[326]:=",ExpressionUUID->"cc91f33f-efc7-49ed-b921-af642849e3d8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[DoubleStruckX]", "==", 
      SubscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", "\[NoBreak]", GridBox[{
            {
             TemplateBox[{"\[DoubleStruckCapitalA]"},
              "Transpose"]},
            {
             TemplateBox[{"\[DoubleStruckCapitalB]"},
              "Transpose"]},
            {
             TemplateBox[{"\[DoubleStruckCapitalC]"},
              "Transpose"]}
           },
           GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
           GridBoxSpacings->{"Columns" -> {
               Offset[0.27999999999999997`], {
                Offset[0.7]}, 
               Offset[0.27999999999999997`]}, "Rows" -> {
               Offset[0.2], {
                Offset[0.4]}, 
               Offset[0.2]}}], "\[NoBreak]", ")"}], "*", 
         RowBox[{"(", "\[NoBreak]", GridBox[{
            {
             SubscriptBox["X", "1"]},
            {
             SubscriptBox["X", "2"]},
            {
             SubscriptBox["X", "3"]}
           },
           GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
           GridBoxSpacings->{"Columns" -> {
               Offset[0.27999999999999997`], {
                Offset[0.7]}, 
               Offset[0.27999999999999997`]}, "Rows" -> {
               Offset[0.2], {
                Offset[0.4]}, 
               Offset[0.2]}}], "\[NoBreak]", ")"}]}], ")"}], "e"]}], "//", 
     "Thread"}], "//", "Unlist"}], "//", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{"BalanceSides", ",", "#"}], "]"}], "&"}]}], "//", 
  "Column"}]], "Input",
 CellChangeTimes->{3.8956620455852203`*^9},
 CellLabel->
  "In[110]:=",ExpressionUUID->"8cb27f81-78db-4e34-9b8f-630d467dea2f"],

Cell[BoxData[
 FormBox[
  TagBox[GridBox[{
     {
      RowBox[{
       RowBox[{
        RowBox[{"x", " ", 
         SubscriptBox["X", "3"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalC]"},
          "Transpose"]}], "-", 
        RowBox[{
         SubscriptBox["X", "1"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalA]"},
          "Transpose"]}]}], "\[LongEqual]", "0"}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["X", "3"], " ", "y", " ", 
         TemplateBox[{"\[DoubleStruckCapitalC]"},
          "Transpose"]}], "-", 
        RowBox[{
         SubscriptBox["X", "2"], " ", 
         TemplateBox[{"\[DoubleStruckCapitalB]"},
          "Transpose"]}]}], "\[LongEqual]", "0"}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], TraditionalForm]], "Output",
 CellChangeTimes->{3.8956620515184927`*^9},
 CellLabel->
  "Out[110]=",ExpressionUUID->"ee34b20c-114d-4068-930b-cc412d6249d3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[DoubleStruckP]", "=", 
   RowBox[{"vec", "[", 
    RowBox[{"\[LeftAngleBracket]", GridBox[{
       {
        SubscriptBox["\[DoubleStruckCapitalA]", "1"]},
       {
        SubscriptBox["\[DoubleStruckCapitalB]", "1"]},
       {
        SubscriptBox["\[DoubleStruckCapitalC]", "1"]}
      }], "\[RightAngleBracket]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   SubscriptBox["a", "x"], "=", 
   RowBox[{"\[LeftAngleBracket]", GridBox[{
      {
       RowBox[{"-", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]},
      {
       SubscriptBox["\[DoubleStruckCapitalZ]", "4"]},
      {
       RowBox[{"x", " ", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]}
     }], "\[RightAngleBracket]"}]}], ";", 
  RowBox[{
   SubscriptBox["a", "y"], "=", 
   RowBox[{"\[LeftAngleBracket]", GridBox[{
      {
       SubscriptBox["\[DoubleStruckCapitalZ]", "4"]},
      {
       RowBox[{"-", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]},
      {
       RowBox[{"y", " ", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]}
     }], "\[RightAngleBracket]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", GridBox[{
        {
         RowBox[{
          SubscriptBox["a", "x"], "\[Transpose]"}]},
        {
         RowBox[{
          SubscriptBox["a", "y"], "\[Transpose]"}]}
       }], "\[RightAngleBracket]"}], ".", " ", "\[DoubleStruckP]"}], "==", 
    "0"}], "//", "Thread"}], "//", "Column"}]}], "Input",
 CellChangeTimes->{{3.8956622925947347`*^9, 3.895662305529789*^9}, {
  3.895662404885215*^9, 3.8956625875220857`*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"98a4fb25-04c7-4434-a046-30fcf0604816"],

Cell[BoxData[
 FormBox[
  TagBox[GridBox[{
     {
      RowBox[{
       RowBox[{
        RowBox[{"x", " ", "X", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "1"}]]}], "+", 
        RowBox[{"x", " ", "Y", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "2"}]]}], "+", 
        RowBox[{"x", " ", "Z", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "3"}]]}], "+", 
        RowBox[{"x", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}], "-", 
        RowBox[{"X", " ", 
         SubscriptBox["p", 
          RowBox[{"1", ",", "1"}]]}], "-", 
        RowBox[{"Y", " ", 
         SubscriptBox["p", 
          RowBox[{"1", ",", "2"}]]}], "-", 
        RowBox[{"Z", " ", 
         SubscriptBox["p", 
          RowBox[{"1", ",", "3"}]]}], "-", 
        SubscriptBox["p", 
         RowBox[{"1", ",", "4"}]]}], "\[LongEqual]", "0"}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{"X", " ", "y", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "1"}]]}], "-", 
        RowBox[{"X", " ", 
         SubscriptBox["p", 
          RowBox[{"2", ",", "1"}]]}], "+", 
        RowBox[{"y", " ", "Y", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "2"}]]}], "+", 
        RowBox[{"y", " ", "Z", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "3"}]]}], "+", 
        RowBox[{"y", " ", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}], "-", 
        RowBox[{"Y", " ", 
         SubscriptBox["p", 
          RowBox[{"2", ",", "2"}]]}], "-", 
        RowBox[{"Z", " ", 
         SubscriptBox["p", 
          RowBox[{"2", ",", "3"}]]}], "-", 
        SubscriptBox["p", 
         RowBox[{"2", ",", "4"}]]}], "\[LongEqual]", "0"}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], TraditionalForm]], "Output",
 CellChangeTimes->{
  3.8956626199517546`*^9, 3.895662860281055*^9, {3.895667196060769*^9, 
   3.8956672255553045`*^9}},
 CellLabel->"Out[43]=",ExpressionUUID->"ecabfa65-0a35-43f1-947d-9c7722db7cd7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[LeftAngleBracket]", GridBox[{
    {
     RowBox[{
      SubscriptBox["a", "x"], "\[Transpose]"}]},
    {
     RowBox[{
      SubscriptBox["a", "y"], "\[Transpose]"}]}
   }], "\[RightAngleBracket]"}]], "Input",
 CellChangeTimes->{3.8956628695829787`*^9},
 CellLabel->
  "In[131]:=",ExpressionUUID->"f00cbe6d-2472-4029-b229-051eac8d5708"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "X"}], 
      RowBox[{"-", "Y"}], 
      RowBox[{"-", "Z"}], 
      RowBox[{"-", "1"}], "0", "0", "0", "0", 
      RowBox[{"x", " ", "X"}], 
      RowBox[{"x", " ", "Y"}], 
      RowBox[{"x", " ", "Z"}], "x"},
     {"0", "0", "0", "0", 
      RowBox[{"-", "X"}], 
      RowBox[{"-", "Y"}], 
      RowBox[{"-", "Z"}], 
      RowBox[{"-", "1"}], 
      RowBox[{"X", " ", "y"}], 
      RowBox[{"y", " ", "Y"}], 
      RowBox[{"y", " ", "Z"}], "y"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.895662870495535*^9},
 CellLabel->
  "Out[131]=",ExpressionUUID->"694fd886-8527-470a-845f-001c72c526d0"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["If 3D point are on a plane", "Subsubsection",
 CellChangeTimes->{{3.8956669607400007`*^9, 
  3.895666986859572*^9}},ExpressionUUID->"25a276d9-7071-45a2-94a6-\
737870ff3a2a"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[DoubleStruckX]", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"x"},
      {"y"}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], ";", 
  RowBox[{"\[DoubleStruckCapitalX]", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"X"},
      {"Y"},
      {"0"}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["a", "x"], "=", 
   RowBox[{"\[LeftAngleBracket]", GridBox[{
      {
       RowBox[{"-", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]},
      {
       SubscriptBox["\[DoubleStruckCapitalZ]", "4"]},
      {
       RowBox[{"x", " ", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]}
     }], "\[RightAngleBracket]"}]}], ";", 
  RowBox[{
   SubscriptBox["a", "y"], "=", 
   RowBox[{"\[LeftAngleBracket]", GridBox[{
      {
       SubscriptBox["\[DoubleStruckCapitalZ]", "4"]},
      {
       RowBox[{"-", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]},
      {
       RowBox[{"y", " ", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]}
     }], "\[RightAngleBracket]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[LeftAngleBracket]", GridBox[{
    {
     RowBox[{
      SubscriptBox["a", "x"], "\[Transpose]"}]},
    {
     RowBox[{
      SubscriptBox["a", "y"], "\[Transpose]"}]}
   }], "\[RightAngleBracket]"}]}], "Input",
 CellChangeTimes->{{3.895666915951625*^9, 3.895666936841109*^9}, {
  3.8956670118248405`*^9, 3.895667023869915*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"95789cf2-b3a8-4236-a2f7-7ad91cf301ca"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "X"}], 
      RowBox[{"-", "Y"}], "0", 
      RowBox[{"-", "1"}], "0", "0", "0", "0", 
      RowBox[{"x", " ", "X"}], 
      RowBox[{"x", " ", "Y"}], "0", "x"},
     {"0", "0", "0", "0", 
      RowBox[{"-", "X"}], 
      RowBox[{"-", "Y"}], "0", 
      RowBox[{"-", "1"}], 
      RowBox[{"X", " ", "y"}], 
      RowBox[{"y", " ", "Y"}], "0", "y"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.8956670256643004`*^9, 3.8956672500409374`*^9},
 CellLabel->"Out[46]=",ExpressionUUID->"7cee30a6-7ef1-48e7-bf2b-08ad7774d89c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[DoubleStruckCapitalX]", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"X"},
      {"Y"}
     },
     GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.7]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}}], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["a", "x"], "=", 
   RowBox[{"\[LeftAngleBracket]", GridBox[{
      {
       RowBox[{"-", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]},
      {
       SubscriptBox["\[DoubleStruckCapitalZ]", "3"]},
      {
       RowBox[{"x", " ", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]}
     }], "\[RightAngleBracket]"}]}], ";", 
  RowBox[{
   SubscriptBox["a", "y"], "=", 
   RowBox[{"\[LeftAngleBracket]", GridBox[{
      {
       SubscriptBox["\[DoubleStruckCapitalZ]", "3"]},
      {
       RowBox[{"-", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]},
      {
       RowBox[{"y", " ", 
        SubscriptBox["\[DoubleStruckCapitalX]", "H"]}]}
     }], "\[RightAngleBracket]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[LeftAngleBracket]", GridBox[{
    {
     RowBox[{
      SubscriptBox["a", "x"], "\[Transpose]"}]},
    {
     RowBox[{
      SubscriptBox["a", "y"], "\[Transpose]"}]}
   }], "\[RightAngleBracket]"}]}], "Input",
 CellChangeTimes->{{3.8956673545683002`*^9, 3.8956674426823683`*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"9397d29e-88de-45a2-9370-29ca6b5f0755"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "X"}], 
      RowBox[{"-", "Y"}], 
      RowBox[{"-", "1"}], "0", "0", "0", 
      RowBox[{"x", " ", "X"}], 
      RowBox[{"x", " ", "Y"}], "x"},
     {"0", "0", "0", 
      RowBox[{"-", "X"}], 
      RowBox[{"-", "Y"}], 
      RowBox[{"-", "1"}], 
      RowBox[{"X", " ", "y"}], 
      RowBox[{"y", " ", "Y"}], "y"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.895667449463569*^9},
 CellLabel->"Out[52]=",ExpressionUUID->"a1d06fdb-31ff-458b-ac1f-cf81b07cb516"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", GridBox[{
        {
         RowBox[{
          SubscriptBox["a", "x"], "\[Transpose]"}]},
        {
         RowBox[{
          SubscriptBox["a", "y"], "\[Transpose]"}]}
       }], "\[RightAngleBracket]"}], ".", 
     RowBox[{"Array", "[", 
      RowBox[{
       RowBox[{
        SubscriptBox["h", "##"], "&"}], ",", 
       RowBox[{"{", "9", "}"}]}], "]"}]}], "==", "0"}], "//", "Thread"}], "//",
   "Column"}]], "Input",
 CellChangeTimes->{{3.895667466964306*^9, 3.895667468606324*^9}, {
  3.895667532516261*^9, 3.895667563564618*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"649b1283-dfdf-456d-aaa6-4cb864aac50f"],

Cell[BoxData[
 FormBox[
  TagBox[GridBox[{
     {
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["h", "7"], " ", "x", " ", "X"}], "+", 
        RowBox[{
         SubscriptBox["h", "8"], " ", "x", " ", "Y"}], "+", 
        RowBox[{
         SubscriptBox["h", "9"], " ", "x"}], "+", 
        RowBox[{
         SubscriptBox["h", "1"], " ", 
         RowBox[{"(", 
          RowBox[{"-", "X"}], ")"}]}], "-", 
        RowBox[{
         SubscriptBox["h", "2"], " ", "Y"}], "-", 
        SubscriptBox["h", "3"]}], "\[LongEqual]", "0"}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["h", "7"], " ", "X", " ", "y"}], "+", 
        RowBox[{
         SubscriptBox["h", "4"], " ", 
         RowBox[{"(", 
          RowBox[{"-", "X"}], ")"}]}], "+", 
        RowBox[{
         SubscriptBox["h", "8"], " ", "y", " ", "Y"}], "+", 
        RowBox[{
         SubscriptBox["h", "9"], " ", "y"}], "-", 
        RowBox[{
         SubscriptBox["h", "5"], " ", "Y"}], "-", 
        SubscriptBox["h", "6"]}], "\[LongEqual]", "0"}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], TraditionalForm]], "Output",
 CellChangeTimes->{
  3.8956674699094625`*^9, {3.895667534514167*^9, 3.8956675645017548`*^9}},
 CellLabel->"Out[56]=",ExpressionUUID->"ebd6b923-5def-42d2-a546-4ca045cdce92"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  TagBox[GridBox[{
     {
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["h", "1"], " ", 
         RowBox[{"(", 
          RowBox[{"-", "X"}], ")"}]}], "-", 
        RowBox[{
         SubscriptBox["h", "2"], " ", "Y"}], "-", 
        SubscriptBox["h", "3"], "+", 
        RowBox[{"0", 
         SubscriptBox["h", "4"]}], "+", 
        RowBox[{"0", 
         SubscriptBox["h", "5"]}], "+", 
        RowBox[{"0", 
         SubscriptBox["h", "6"]}], "+", 
        RowBox[{
         SubscriptBox["h", "7"], " ", "x", " ", "X"}], "+", 
        RowBox[{
         SubscriptBox["h", "8"], " ", "x", " ", "Y"}], "+", 
        RowBox[{
         SubscriptBox["h", "9"], " ", "x"}]}], "\[LongEqual]", "0"}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{"0", 
         SubscriptBox["h", "1"]}], "+", 
        RowBox[{"0", 
         SubscriptBox["h", "2"]}], "+", 
        RowBox[{"0", 
         SubscriptBox["h", "3"]}], "+", 
        RowBox[{
         SubscriptBox["h", "4"], " ", 
         RowBox[{"(", 
          RowBox[{"-", "X"}], ")"}]}], "-", 
        RowBox[{
         SubscriptBox["h", "5"], " ", "Y"}], "-", 
        SubscriptBox["h", "6"], "+", 
        RowBox[{
         SubscriptBox["h", "7"], " ", "X", " ", "y"}], "+", 
        RowBox[{
         SubscriptBox["h", "8"], " ", "y", " ", "Y"}], "+", 
        RowBox[{
         SubscriptBox["h", "9"], " ", "y"}]}], "\[LongEqual]", "0"}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.895765124930375*^9, 
  3.895765296818411*^9}},ExpressionUUID->"9ff32df5-18e9-4591-96a3-\
684082c8d62e"],

Cell[TextData[{
 "Homography on 3d plane\nPlain [a b c d]\n",
 Cell[BoxData[
  RowBox[{
   RowBox[{"aX", "+", "bY", "+", "cZ", "+", "d"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"0", " ", "\[Implies]", " ", "Z"}], "=", 
    FractionBox[
     RowBox[{"aX", "+", "bY", "+", "d"}], 
     RowBox[{"-", "c"}]]}]}]], "InlineCode",ExpressionUUID->
  "edcaee5b-14b7-47b9-935a-e4726ab3626f"],
 "\n",
 Cell[BoxData[
  RowBox[{
   RowBox[{"(", GridBox[{
      {"X"},
      {"Y"},
      {"Z"},
      {"1"}
     }], ")"}], "=", 
   RowBox[{"(", GridBox[{
      {"X"},
      {"Y"},
      {
       FractionBox[
        RowBox[{"aX", "+", "bY", "+", "d"}], 
        RowBox[{"-", "c"}]]},
      {"1"}
     }], ")"}]}]], "InlineCode",ExpressionUUID->
  "4f95b7c4-a78f-4309-9729-96baae440520"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"(", GridBox[{
       {"x"},
       {"y"},
       {"1"}
      }], ")"}], "=", 
    RowBox[{
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "2"}]], "0", 
         SubscriptBox["p", 
          RowBox[{"1", ",", "4"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "2"}]], "0", 
         SubscriptBox["p", 
          RowBox[{"2", ",", "4"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "2"}]], "0", 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}], 
     RowBox[{"(", GridBox[{
        {"X"},
        {"Y"},
        {
         FractionBox[
          RowBox[{"aX", "+", "bY", "+", "d"}], 
          RowBox[{"-", "c"}]]},
        {"1"}
       }], ")"}]}]}], TraditionalForm]],ExpressionUUID->
  "a3e2c3ec-aaf5-477b-a096-a11bb6043285"]
}], "Text",
 CellChangeTimes->{{3.89569289663721*^9, 3.895693065791605*^9}, {
  3.895693137702179*^9, 3.895693140060755*^9}, {3.8956931718825808`*^9, 
  3.895693259094189*^9}},ExpressionUUID->"c80edfba-11d8-48f3-b987-\
20a2a7be6704"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Function", "Subsubsection",ExpressionUUID->"922adf84-55e9-44bf-b558-fe576790fb59"],

Cell[TextData[{
 " Normalizing transformations is needed for better results.\nSources:\n\
Multiple View Geometry in Computer Vision (2nd Edition)  Hartley and ",
 StyleBox["Zisserman",
  IgnoreSpellCheck->True],
 "  -  4.4.4 Normalizing transformations - Page 107\n Data normalization - \
Page 180\nHomography Estimation by Elan ",
 StyleBox["Dubrofsky",
  IgnoreSpellCheck->True],
 " -  2.1.1 Normalization - Page 11"
}], "Text",ExpressionUUID->"7ca49f58-6c02-4442-ac8c-97d6999ccb5f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DLTNormalizationMatrix", "::", "usage"}], "=", 
   "\"\<normalization transformation matrix for points near the camera\nbased \
on Multiple View Geometry in Computer Vision Page 107,180\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"DLTNormalizationMatrix", "[", "points_List", "]"}], ":=", 
  RowBox[{"Module", "[", "\n", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mean", ",", " ", "len", ",", "scale"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"mean", " ", "=", " ", 
      RowBox[{"Mean", "@", "points"}]}], ";", "\n", 
     RowBox[{"len", " ", "=", " ", 
      RowBox[{
       RowBox[{"Dimensions", "[", "points", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "make", " ", "mean", " ", "centroid", " ", "of", " ", "all", " ", 
       "points"}], " ", "*)"}], "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "scale", " ", "average", " ", "distance", " ", "from", " ", "the", " ", 
       "origin"}], " ", "*)"}], "\n", 
     RowBox[{"scale", " ", "=", " ", 
      RowBox[{
       RowBox[{"Sqrt", "[", "len", "]"}], "/", 
       RowBox[{"RootMeanSquare", "[", 
        RowBox[{"Norm", "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "-", "mean"}], "&"}], "/@", "points"}], ")"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{"transformation", " ", "matrix"}], " ", "*)"}], "\n", 
     RowBox[{"mean", "=", 
      RowBox[{"List", "/@", "mean"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"transform", " ", "to", " ", "vector"}], "*)"}], "\n", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"scale", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", "len", "]"}], ",", 
           RowBox[{"-", "mean"}]}], "}"}]}], ",", "\n", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "}"}], "]"}]}]}], "\n", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8956635824112325`*^9, 3.8956636317584915`*^9}},
 CellLabel->
  "In[327]:=",ExpressionUUID->"41ed739e-de60-4c01-9084-fbaca9e8bbf8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ToHom", "::", "usage"}], "=", 
   "\"\<converts points to homogeneous\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ToHom", "[", 
   RowBox[{"ls", ":", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_", "?", "NumericQ"}], ",", "_"}], "}"}], "|", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_", "?", "NumericQ"}], ",", "_", ",", "_"}], "}"}]}]}], "]"}],
   ":=", 
  RowBox[{"ls", "//", 
   RowBox[{"Append", "@", "1"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToHom", "[", 
    RowBox[{"ls", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_", "?", "NumericQ"}], ",", "_"}], "}"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_", "?", "NumericQ"}], ",", "_", ",", "_"}], "}"}]}], 
        ")"}], ".."}], "}"}]}], "]"}], ":=", 
   RowBox[{"ToHom", "/@", "ls"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FromHom", "::", "usage"}], "=", 
   "\"\<converts points from homogeneous\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"FromHom", "[", 
   RowBox[{"ls", ":", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_", "?", "NumericQ"}], ",", "_", ",", "_"}], "}"}], "|", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_", "?", "NumericQ"}], ",", "_", ",", "_", ",", "_"}], 
      "}"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Most", "@", "ls"}], "/", 
   RowBox[{"Last", "@", "ls"}]}]}], "\n", 
 RowBox[{
  RowBox[{"FromHom", "[", 
   RowBox[{"ls", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ",", "_", ",", "_"}], "}"}], "|", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ",", "_", ",", "_", ",", "_"}], 
         "}"}]}], ")"}], ".."}], "}"}]}], "]"}], ":=", 
  RowBox[{"FromHom", "/@", "ls"}]}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[329]:=",ExpressionUUID->"f8246bcc-52a0-41df-8430-7871a1f2a7d1"],

Cell[TextData[{
 Cell[BoxData[
  RowBox[{
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", GridBox[{
       {
        RowBox[{
         SubscriptBox["a", "x"], "\[Transpose]"}]},
       {
        RowBox[{
         SubscriptBox["a", "y"], "\[Transpose]"}]}
      }], "\[RightAngleBracket]"}], ".", " ", "\[DoubleStruckP]"}], "==", 
   "0"}]],
  CellChangeTimes->{{3.8956622925947347`*^9, 3.895662305529789*^9}, {
   3.895662404885215*^9, 3.8956625875220857`*^9}},ExpressionUUID->
  "62d6a19d-3874-4866-9248-67eec9fb9b8b"],
 " or for all points ",
 Cell[BoxData[
  RowBox[{
   RowBox[{"\[DoubleStruckCapitalA]", ".", "\[DoubleStruckP]"}], "==", "0"}]],
  CellChangeTimes->{{3.8956622925947347`*^9, 3.895662305529789*^9}, {
   3.895662404885215*^9, 3.8956625875220857`*^9}},ExpressionUUID->
  "0fd147c0-e40f-4a06-b413-ed8224a7633e"],
 "\nsolution is minimization of \[DoubleStruckP]\n",
 StyleBox["(solution 1)",
  FontWeight->"Bold"],
 "\n",
 Cell[BoxData[
  RowBox[{"U", ",", "D", ",", 
   RowBox[{"V", "=", 
    RowBox[{"SVD", 
     RowBox[{"(", "\[DoubleStruckCapitalA]", ")"}]}]}]}]], "InlineCode",
  ExpressionUUID->"097f2582-c3de-4e11-ba62-ccb7a2adb0c2"],
 "\nU has no effect\nminimal \[DoubleStruckP] depends on smallest value of D \
which is the last column\nso the answer has to be in the last column of V\n",
 StyleBox["(solution 2)",
  FontWeight->"Bold"],
 "\n(*eigenvector with smallest eigenvalue*)\n\
{eigenvalue,eigenvector}=Eigensystem[A\[Transpose].A]\n\
#\[LeftDoubleBracket]2,First@Ordering[#\[LeftDoubleBracket]1\
\[RightDoubleBracket],1]\[RightDoubleBracket]&@Eigensystem[A\[Transpose].A]//\
Partition[#,4]&"
}], "Text",
 CellChangeTimes->{{3.8956642454692907`*^9, 3.8956642765227833`*^9}, {
  3.895665730924014*^9, 3.895665828389761*^9}, {3.8956658621366234`*^9, 
  3.895665868579815*^9}, {3.8956659167433214`*^9, 3.8956660476105733`*^9}, {
  3.8956660869169025`*^9, 3.895666089852751*^9}, {3.8956662695280237`*^9, 
  3.895666343281869*^9}, {3.8956663735013757`*^9, 3.8956663990449934`*^9}, {
  3.8956664596083384`*^9, 
  3.895666507653146*^9}},ExpressionUUID->"38c6f77c-9986-4c92-804a-\
ef5f66630fed"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CameraCalibration", "[", 
   RowBox[{"imageP_", ",", "wordP_", ",", "\"\<DLT\>\""}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"world", "=", "wordP"}], ",", " ", 
      RowBox[{"image", "=", "imageP"}], ",", "imgT", ",", "worldT", ",", "\n",
       "A", ",", "P", ",", "M"}], "}"}], ",", "\n", 
    RowBox[{"(*", " ", 
     RowBox[{"Normalize", " ", "the", " ", 
      RowBox[{"points", "."}]}], " ", "*)"}], "\n", 
    RowBox[{
     RowBox[{"imgT", " ", "=", " ", 
      RowBox[{"DLTNormalizationMatrix", "@", "image"}]}], ";", "\n", 
     RowBox[{"worldT", " ", "=", " ", 
      RowBox[{"DLTNormalizationMatrix", "@", "world"}]}], ";", 
     RowBox[{"image", "=", 
      RowBox[{
       RowBox[{"ToHom", "[", "image", "]"}], ".", 
       RowBox[{"imgT", "\[Transpose]"}]}]}], ";", 
     RowBox[{"world", "=", 
      RowBox[{
       RowBox[{"ToHom", "[", "world", "]"}], ".", 
       RowBox[{"worldT", "\[Transpose]"}]}]}], ";", "\[IndentingNewLine]", 
     "\n", 
     RowBox[{"(*", 
      RowBox[{
      "build", " ", "the", " ", "homogeneous", " ", "linear", " ", "system"}],
       "*)"}], "\n", 
     RowBox[{
      RowBox[{"M", "[", 
       RowBox[{"{", 
        RowBox[{
        "X_", ",", "Y_", ",", "Z_", ",", "_", ",", "x_", ",", "y_", ",", 
         "_"}], "}"}], "]"}], ":=", 
      RowBox[{"Join", "@@@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "Z", ",", "1"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"x", "*", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "Z", ",", "1"}], "}"}]}]}], "}"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "Z", ",", "1"}], "}"}]}], ",", 
           RowBox[{"y", "*", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "Z", ",", "1"}], "}"}]}]}], "}"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], ";", "\n", 
     RowBox[{"A", "=", 
      RowBox[{"M", "/@", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{"world", ",", "image"}], "}"}], "}"}], "]"}]}]}], ";", "\n", 
     RowBox[{"A", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"A", ",", "1"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"P", " ", "=", " ", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"SingularValueDecomposition", "[", "A", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "All", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "4"}], "]"}]}], ";", "\n", 
     RowBox[{"(*", " ", "denormalize", " ", "*)"}], "\n", 
     RowBox[{"-", 
      RowBox[{
       RowBox[{"Inverse", "[", "imgT", "]"}], ".", "P", ".", "worldT"}]}]}]}],
    "\n", "]"}]}]], "Input",
 CellChangeTimes->{{3.895660109403513*^9, 3.89566012315172*^9}, {
   3.895660156600226*^9, 3.8956601821409116`*^9}, {3.8956645123555155`*^9, 
   3.8956645155672283`*^9}, {3.8956647965900836`*^9, 
   3.8956648265231295`*^9}, {3.895664878578215*^9, 3.895664882314768*^9}, 
   3.895664956460205*^9, {3.8956649921370077`*^9, 3.8956649962081876`*^9}, {
   3.8957504339872327`*^9, 3.895750476062434*^9}},
 CellLabel->
  "In[521]:=",ExpressionUUID->"ac6a248a-86fd-4c9d-88d3-e0fe861ffb74"],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"P", "=", 
    RowBox[{
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         SubscriptBox["p", 
          RowBox[{"1", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "2"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "3"}]], 
         SubscriptBox["p", 
          RowBox[{"1", ",", "4"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"2", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "2"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "3"}]], 
         SubscriptBox["p", 
          RowBox[{"2", ",", "4"}]]},
        {
         SubscriptBox["p", 
          RowBox[{"3", ",", "1"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "2"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "3"}]], 
         SubscriptBox["p", 
          RowBox[{"3", ",", "4"}]]}
       },
       GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.7]}, 
           Offset[0.27999999999999997`]}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}}], "\[NoBreak]", ")"}], "=", 
     RowBox[{
      RowBox[{"(", GridBox[{
         {"\[ScriptCapitalH]", "\[ScriptH]"}
        }], ")"}], "=", 
      RowBox[{"(", GridBox[{
         {
          RowBox[{"\[CapitalKappa]", ".", "R"}], 
          RowBox[{"-", 
           RowBox[{"\[CapitalKappa]", ".", "R", ".", 
            RowBox[{"(", GridBox[{
               {
                SubscriptBox["t", "1"]},
               {
                SubscriptBox["t", "2"]},
               {
                SubscriptBox["t", "3"]}
              }], ")"}]}]}]}
        }], ")"}]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "f800c1e5-3f11-4465-95fd-2b4583b4f74b"],
 "\n\n  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[ScriptCapitalH]", "=", 
    RowBox[{"\[CapitalKappa]", ".", "R"}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "03352179-d694-492e-a0c9-45c3b810651e"],
 "  and  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"h", "=", 
    RowBox[{"-", 
     RowBox[{"\[CapitalKappa]", ".", "R", ".", 
      SubscriptBox["X", "0"]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "0866c926-0213-4bd2-85ba-714616e907e2"],
 "\n\[ScriptCapitalH]^-1=(\[CapitalKappa] . R)^-1=R^-1 K^-1\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["\[ScriptCapitalH]", 
     RowBox[{"-", "1"}]], "=", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"K", ".", "R"}], ")"}], 
      RowBox[{"-", "1"}]], "=", 
     RowBox[{
      SuperscriptBox["R", 
       RowBox[{"-", "1"}]], 
      SuperscriptBox["K", 
       RowBox[{"-", "1"}]]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "a3a712bf-7db2-4b7e-9a69-83af1950207b"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["R", 
     RowBox[{"-", "1"}]], "=", 
    RowBox[{"R", "\[Transpose]"}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "f7c72477-5f28-4761-b404-0a2ee8b1cae4"],
 " since R is a rotation matrix"
}], "Text",
 CellChangeTimes->{{3.8956637001365323`*^9, 3.895663898767624*^9}, {
  3.8956639483983436`*^9, 
  3.895664008671733*^9}},ExpressionUUID->"76e306bd-eb33-4aa7-b7ce-\
4f4a35dcfe2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DecomposeProjectionMatrix", "[", "mat_", "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"K", ",", "R", ",", "t", ",", 
      RowBox[{"P", "=", "mat"}], ",", "H", ",", "h", ",", "r180"}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{"(*", "  ", 
     RowBox[{
     "H", " ", "as", " ", "the", " ", "first", " ", "three", " ", "columns", 
      " ", "of", " ", 
      RowBox[{"P", "."}]}], " ", "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"H", " ", "=", " ", 
      RowBox[{"P", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"H", "=", 
       RowBox[{"K", ".", "R"}]}], " ", "*)"}], "\n", "\t", 
     RowBox[{"h", " ", "=", " ", 
      RowBox[{"P", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "4"}], "]"}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"h", "=", 
       RowBox[{"-", 
        RowBox[{"K", ".", "R", ".", 
         SubscriptBox["X", "0"]}]}]}], " ", "*)"}], "\n", "\t", 
     RowBox[{"t", "=", 
      RowBox[{
       RowBox[{"Inverse", "[", 
        RowBox[{"-", "H"}], "]"}], " ", ".", " ", "h"}]}], ";", 
     "\[IndentingNewLine]", "    ", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"also", " ", "t"}], "=", 
       RowBox[{"FromHom", "@", 
        RowBox[{"NullSpace", "[", "P", "]"}]}]}], " ", "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"R", ",", "K"}], "}"}], "=", 
      RowBox[{"QRDecomposition", "[", 
       RowBox[{"Inverse", "[", "H", "]"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "rotate", " ", "180", " ", "deg", " ", "to", " ", "face", " ", "the", 
       " ", "scene"}], " ", "*)"}], "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"r180", "=", 
        RowBox[{"RotationMatrix", "[", 
         RowBox[{
          RowBox[{"180", " ", "Degree"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";"}], "*)"}],
      "\n", "\t", 
     RowBox[{"K", "=", 
      RowBox[{"Inverse", "[", "K", "]"}]}], ";", "\n", "\t", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"K", "/", 
        RowBox[{"K", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ",", 
       RowBox[{"-", "R"}], ",", "t"}], "}"}]}]}], "\n", "]"}]}]], "Input",
 CellChangeTimes->{{3.8956730222308435`*^9, 3.895673028659663*^9}, {
  3.8956750396061316`*^9, 
  3.8956750611989403`*^9}},ExpressionUUID->"0a0505f0-ebc6-4d66-9aa8-\
b2d046ab7f51"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SplitMatrix", "[", 
   RowBox[{"mat_", ",", 
    RowBox[{"span", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"_Span", "|", "_Integer"}], ")"}], ".."}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"SplitMatrix", "[", 
   RowBox[{"mat", ",", "span", ",", "\"\<row\>\""}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SplitMatrix", "[", 
   RowBox[{"mat_", ",", 
    RowBox[{"span", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"_Span", "|", "_Integer"}], ")"}], ".."}], "}"}]}], ",", 
    "\"\<row\>\""}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Switch", "[", 
     RowBox[{"#", ",", "\[IndentingNewLine]", "_Span", ",", 
      RowBox[{"mat", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "#"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
      "_Integer", ",", 
      RowBox[{"List", "/@", 
       RowBox[{"mat", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "#"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}], "&"}], "/@", "span"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SplitMatrix", "[", 
    RowBox[{"mat_", ",", 
     RowBox[{"span", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"_Span", "|", "_Integer"}], ")"}], ".."}], "}"}]}], ",", 
     "\"\<col\>\""}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Switch", "[", 
      RowBox[{"#", ",", "\[IndentingNewLine]", "_Span", ",", 
       RowBox[{"mat", "[", 
        RowBox[{"[", 
         RowBox[{"#", ",", "All"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       "_Integer", ",", 
       RowBox[{"List", "@", 
        RowBox[{"mat", "[", 
         RowBox[{"[", 
          RowBox[{"#", ",", "All"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}], "&"}], "/@", "span"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SplitMatrix", "[", "mat_", "]"}], ":=", 
  RowBox[{"SplitMatrix", "[", 
   RowBox[{"mat", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "mat", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}], "//", "Range"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SplitMatrix", "[", 
   RowBox[{"mat_", ",", "\"\<col\>\""}], "]"}], ":=", 
  RowBox[{"SplitMatrix", "[", 
   RowBox[{"mat", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "mat", "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}], "//", "Range"}], ",", "\"\<col\>\""}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{
  3.8958241012840605`*^9},ExpressionUUID->"2ccf1027-9be7-45a2-a590-\
89a0dd585c44"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples 1", "Subsubsection",
 CellChangeTimes->{{3.8959436229133887`*^9, 
  3.8959436238836346`*^9}},ExpressionUUID->"2f5948b7-0e8d-418e-8843-\
e770c4febd93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "data", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"worldPoints", "=", 
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}], ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"0", ",", " ", "1", ",", " ", "1"}], "}"}], ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "0", ",", " ", "1"}], "}"}], ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "1", ",", " ", "0"}], "}"}], ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "1", ",", " ", "1"}], "}"}]}], "}"}]}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{"imagePoints", "=", 
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"29.600000000000023", ",", " ", "112.66666666666669"}], "}"}],
        ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"19.33333333333337", ",", " ", "297.4666666666666"}], "}"}], 
       ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"175.20000000000005", ",", " ", "353.3080957242207"}], "}"}], 
       ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"176.14562558795865", ",", " ", "24.230391114624922"}], "}"}],
        ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"178.03687676387585", ",", " ", "224.70301576184983"}], "}"}],
        ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"314.2069614299153", ",", " ", "118.79294991048579"}], "}"}], 
       ",", " ", "\n", 
       RowBox[{"{", 
        RowBox[{"332.1738476011287", ",", " ", "296.57056044670406"}], 
        "}"}]}], "}"}]}], ";"}]}]}]], "Code",
 InitializationCell->False,
 CellLabel->"In[23]:=",ExpressionUUID->"4e6847c9-615b-44c3-ac3f-55cccbb48681"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DLTNormalizationMatrix", "[", "imagePoints", "]"}]], "Input",
 CellLabel->"In[25]:=",ExpressionUUID->"ffd45a87-332e-428a-9dcb-03b4c91a318f"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0.008883263038682261`", "0.`", 
      RowBox[{"-", "1.554186062515101`"}]},
     {"0.`", "0.008883263038682261`", 
      RowBox[{"-", "1.8118536115025878`"}]},
     {"0", "0", "1"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.895659797536086*^9, 3.8956645769420137`*^9, 
  3.895665628867856*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"8baea5b5-731e-4357-8ba6-f638ff50c251"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"CameraCalibration", "[", 
  RowBox[{"imagePoints", ",", "worldPoints", ",", "\"\<DLT\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{3.895659812540148*^9},
 CellLabel->"In[26]:=",ExpressionUUID->"2eb59408-4900-41a5-a5aa-29628fec1473"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"79.95949191721644`", "105.96566756345499`", 
      RowBox[{"-", "8.201073651188304`"}], "18.86727021108271`"},
     {
      RowBox[{"-", "57.851361823805554`"}], "63.24156182939845`", 
      "99.53018456002853`", "71.59732965736882`"},
     {
      RowBox[{"-", "0.0703264423977146`"}], "0.08818219871475193`", 
      RowBox[{"-", "0.05765125711231964`"}], "0.6332573141707354`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.895664590857188*^9, 3.8956648439698567`*^9, 
  3.8956648989686327`*^9, 3.8956649667915025`*^9, 3.895665082465723*^9, 
  3.8956656335834045`*^9},
 CellLabel->"Out[26]=",ExpressionUUID->"4d83103f-d2dc-4913-85c4-67f6a4009dc8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"DecomposeProjectionMatrix", "@", 
   RowBox[{"CameraCalibration", "[", 
    RowBox[{"imagePoints", ",", "worldPoints", ",", "\"\<DLT\>\""}], "]"}]}], 
  "//", "Column"}]], "Input",
 CellChangeTimes->{3.8956650940737762`*^9},
 CellLabel->"In[27]:=",ExpressionUUID->"e75b2406-c738-4279-9e8b-d47a259379ad"],

Cell[BoxData[
 FormBox[
  TagBox[GridBox[{
     {
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"1016.8198591987231`", "14.727601173863555`", "261.36930993352905`"},
         {"0.`", "1007.9308332126898`", "243.50762778329505`"},
         {"0.`", "0.`", "1.`"}
        },
        GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
        GridBoxSpacings->{"Columns" -> {
            Offset[0.27999999999999997`], {
             Offset[0.7]}, 
            Offset[0.27999999999999997`]}, "Rows" -> {
            Offset[0.2], {
             Offset[0.4]}, 
            Offset[0.2]}}], "\[NoBreak]", ")"}]},
     {
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"0.768124401169556`", "0.6390227899331512`", "0.04043239139554482`"},
         {
          RowBox[{"-", "0.3189825744035349`"}], "0.327145339949477`", 
          "0.889508877851275`"},
         {
          RowBox[{"-", "0.5551891763667625`"}], "0.6961507024311566`", 
          RowBox[{"-", "0.4551254529795088`"}]}
        },
        GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
        GridBoxSpacings->{"Columns" -> {
            Offset[0.27999999999999997`], {
             Offset[0.7]}, 
            Offset[0.27999999999999997`]}, "Rows" -> {
            Offset[0.2], {
             Offset[0.4]}, 
            Offset[0.2]}}], "\[NoBreak]", ")"}]},
     {
      RowBox[{"{", 
       RowBox[{"3.436481670486454`", ",", 
        RowBox[{"-", "2.5469824984388323`"}], ",", "2.8964375710804093`"}], 
       "}"}]}
    },
    DefaultBaseStyle->"Column",
    GridBoxAlignment->{"Columns" -> {{Left}}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
   "Column"], TraditionalForm]], "Output",
 CellChangeTimes->{3.8956645241081157`*^9, 3.8956650991192083`*^9, 
  3.8956656387557087`*^9},
 CellLabel->"Out[27]=",ExpressionUUID->"97ac1c5c-a776-461a-b60e-7daad23d6000"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Camera Matrix", "Subsubsection",
 CellChangeTimes->{{3.8956677211349134`*^9, 3.89566772149233*^9}, {
  3.8959418027176914`*^9, 3.8959418045595894`*^9}, {3.8959418714814596`*^9, 
  3.8959418818857517`*^9}, {3.895942012687168*^9, 
  3.8959420168849783`*^9}},ExpressionUUID->"d99b77c7-2099-4130-b7b5-\
5a06e9aea70f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pixel3", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<name\>\"", "->", "\"\<Pixel 3a\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<cameraMatrix\>\"", "->", 
      RowBox[{"(", GridBox[{
         {"3194.8125", "0", "2023"},
         {"0", "3197.943", "1520.3877"},
         {"0", "0", "1"}
        }], ")"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<pixelArraySize\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"4032", ",", "3024"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<w/h\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"1080.0", ",", "2011.0"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<focalLength\>\"", "->", "4.44"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<physicalSize\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"5.6448", ",", "4.2336"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<focalOr\>\"", "->", "28"}]}], "\[IndentingNewLine]", 
    "|>"}]}], ";"}]], "Input",
 CellChangeTimes->{3.8959421891225014`*^9},
 CellLabel->
  "In[1684]:=",ExpressionUUID->"7dc12ece-a07c-456b-bbfc-def054b8ca0f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"iphone8", "=", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<focalLength\>\"", "->", "3.99"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<pixelArraySize\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"4032", ",", "3024"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<physicalSize\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"4.8", ",", "3.6"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<cameraMatrix\>\"", "->", 
      RowBox[{"(", GridBox[{
         {"3351.6", "0", "2016"},
         {"0", "3351.6", "1512"},
         {"0", "0", "1"}
        }], ")"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";"}]], "Input",
 CellChangeTimes->{3.895942166053403*^9},
 CellLabel->
  "In[1682]:=",ExpressionUUID->"74a84c1c-451a-411f-b792-8367a751640c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findF", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", "\"\<focalLength\>\"", "]"}], "/", 
     FractionBox[
      RowBox[{"#", "[", "\"\<physicalSize\>\"", "]"}], 
      RowBox[{"#", "[", "\"\<pixelArraySize\>\"", "]"}]]}], "&"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8959421402391033`*^9, 3.8959421472155733`*^9}},
 CellLabel->
  "In[1680]:=",ExpressionUUID->"633260b7-329b-486a-b87a-426100b500ff"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"findF", "@", "pixel3", " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    SubscriptBox["f", "x"], ",", 
    RowBox[{
     SubscriptBox["f", "y"], " ", "in", " ", "camera", " ", "matrix"}]}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.895942155565186*^9, 
  3.8959422668421845`*^9}},ExpressionUUID->"569aa28d-b70e-494a-8fc0-\
7a5084271ce4"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{"3171.428571428572`", ",", "3171.428571428572`"}], "}"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{{3.8959421607802687`*^9, 3.895942199332412*^9}},
 CellLabel->
  "Out[1685]=",ExpressionUUID->"e2ed6351-3db5-4e57-b26b-83e0b187adac"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"phisical", " ", "pixel", " ", "size"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", "\"\<physicalSize\>\"", "]"}], "/", 
     RowBox[{"#", "[", "\"\<pixelArraySize\>\"", "]"}]}], "&"}], "@", 
   "pixel3"}]}]], "Input",
 CellChangeTimes->{{3.895942444755192*^9, 3.895942483897957*^9}},
 CellLabel->
  "In[1686]:=",ExpressionUUID->"b6b08f83-1a62-4cd9-8f46-0c5383920085"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{"0.0014`", ",", "0.0014`"}], "}"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.895942485001916*^9},
 CellLabel->
  "Out[1686]=",ExpressionUUID->"e3d3e502-bbd7-488d-99f8-8f972aa1c60c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"generic", " ", "camera"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"height", ",", " ", "width", ",", " ", "center"}], "}"}], ",", 
    "\n", "  ", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"height", ",", " ", "width"}], "}"}], " ", "=", " ", 
      RowBox[{"Reverse", "@", 
       RowBox[{"iphone", "[", "\"\<pixelArraySize\>\"", "]"}]}]}], ";", "\n", 
     "  ", 
     RowBox[{"center", " ", "=", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"height", ",", " ", "width"}], "}"}], " ", "/", " ", "2"}]}], 
     ";", "\n", "  ", 
     RowBox[{"(", 
      RowBox[{"{", "\n", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"height", ",", " ", "0", ",", " ", 
          RowBox[{"center", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "\n", "    ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "height", ",", " ", 
          RowBox[{"center", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", "\n", "    ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "\n", "  ", 
       "}"}], ")"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.895942539667346*^9, 3.8959425559854736`*^9}, {
  3.895942666900736*^9, 
  3.8959426758372045`*^9}},ExpressionUUID->"22ca4370-dfb0-4bbf-8923-\
37d2344cd033"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"3024", "0", "1512"},
     {"0", "3024", "2016"},
     {"0", "0", "1"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.8959425364850187`*^9},
 CellLabel->
  "Out[1687]=",ExpressionUUID->"fb2c9726-1954-41de-a712-94bc8362a6a7"]
}, Open  ]],

Cell[TextData[{
 "Scale matrix  for camera matrix\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"S", "=", 
    RowBox[{"(", GridBox[{
       {"s", "0", "0"},
       {"0", "s", "0"},
       {"0", "0", "0"}
      }], ")"}]}], TraditionalForm]],ExpressionUUID->
  "2df69dd8-f795-4a17-afeb-5955f36ed512"],
 "\n",
 ButtonBox["How does resizing an image affect the intrinsic camera matrix?",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://dsp.stackexchange.com/questions/6055/how-does-resizing-an-\
image-affect-the-intrinsic-camera-matrix"], None},
  ButtonNote->
   "https://dsp.stackexchange.com/questions/6055/how-does-resizing-an-image-\
affect-the-intrinsic-camera-matrix"]
}], "Text",
 CellChangeTimes->{{3.89569208663978*^9, 3.8956921458051367`*^9}, {
  3.8959427750488453`*^9, 3.895942787322733*^9}, {3.895942952393188*^9, 
  3.8959429773482842`*^9}},ExpressionUUID->"48d87327-77fc-4cd6-a461-\
e04a63534fc5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions - Homography", "Subsubsection",
 CellChangeTimes->{{3.8956677211349134`*^9, 3.89566772149233*^9}, {
  3.8959418027176914`*^9, 3.8959418045595894`*^9}, {3.8959418714814596`*^9, 
  3.8959418818857517`*^9}, {3.8959429947171097`*^9, 
  3.8959429955206738`*^9}},ExpressionUUID->"1266da49-16f6-4483-aa84-\
61f4186807d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DecomposeHomography", "[", "H_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"h", ",", "norm", ",", "tnorm"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["h", "1"], ",", 
        SubscriptBox["h", "2"], ",", 
        SubscriptBox["h", "3"]}], "}"}], "=", 
      RowBox[{"SplitMatrix", "@", "H"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["norm", "1"], "=", 
      RowBox[{"Norm", "@", 
       SubscriptBox["h", "1"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["norm", "2"], "=", 
      RowBox[{"Norm", "@", 
       SubscriptBox["h", "2"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["h", "1"], "=", 
      RowBox[{
       RowBox[{
        SubscriptBox["h", "1"], "/", 
        SubscriptBox["norm", "1"]}], "//", "Flatten"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["h", "2"], "=", 
      RowBox[{
       RowBox[{
        SubscriptBox["h", "2"], "/", 
        SubscriptBox["norm", "2"]}], "//", "Flatten"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["norm", "4"], "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["norm", "1"], "+", 
         SubscriptBox["norm", "2"]}], ")"}], "/", "2"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["h", "1"], ",", 
              SubscriptBox["h", "2"], ",", 
              RowBox[{
               SubscriptBox["h", "1"], "\[Cross]", 
               SubscriptBox["h", "2"]}]}], "}"}], "\[Transpose]"}], ",", 
           RowBox[{
            SubscriptBox["h", "3"], "/", 
            SubscriptBox["norm", "4"]}]}], "}"}], "}"}], "]"}], ";"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["h", "1"], ",", 
          SubscriptBox["h", "2"], ",", 
          RowBox[{
           SubscriptBox["h", "1"], "\[Cross]", 
           SubscriptBox["h", "2"]}]}], "}"}], "\[Transpose]"}], ",", 
       RowBox[{
        SubscriptBox["h", "3"], "/", 
        SubscriptBox["norm", "4"]}]}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DecomposeHomography", "[", 
   RowBox[{"H_", ",", 
    RowBox[{"Hnorm_", "?", "MatrixQ"}]}], "]"}], ":=", 
  RowBox[{"DecomposeHomography", "[", 
   RowBox[{
    RowBox[{"Inverse", "[", "Hnorm", "]"}], ".", "H"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DecomposeHomography", "[", 
   RowBox[{"H_", ",", "Hnorm_TransformationFunction"}], "]"}], ":=", 
  RowBox[{"DecomposeHomography", "[", 
   RowBox[{
    RowBox[{"Inverse", "@", 
     RowBox[{"Hnorm", "[", "\"\<TransformationMatrix\>\"", "]"}]}], ".", 
    "H"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.895839007751829*^9, 3.8958391569851055`*^9}, {
   3.89583919358009*^9, 3.895839275210857*^9}, {3.895839309275058*^9, 
   3.8958393361083846`*^9}, 3.895839368141268*^9, {3.895839398857855*^9, 
   3.8958394265858345`*^9}, {3.895839554494675*^9, 3.8958395840927477`*^9}, {
   3.8958397094305906`*^9, 3.8958397211083355`*^9}, 3.8958397896834764`*^9, {
   3.8959189117828946`*^9, 3.895918937745865*^9}, {3.895919109433454*^9, 
   3.895919154512951*^9}, {3.8959192001557245`*^9, 3.8959192492325735`*^9}, 
   3.895919295219692*^9, 3.8959193772332196`*^9},
 CellLabel->
  "In[1440]:=",ExpressionUUID->"2d9ce86a-7deb-4a01-8dee-34165de4e2b3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PointsProjection", "[", 
   RowBox[{"K_", ",", "R_", ",", "t_"}], "]"}], ":=", 
  RowBox[{"Composition", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TransformationFunction", "@", "K"}], ",", "\[IndentingNewLine]", 
    RowBox[{"TransformationFunction", "@", 
     RowBox[{"ArrayFlatten", "@", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"R", ",", "t"}], "}"}], "}"}]}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PointsProjection", "[", 
   RowBox[{"K_", ",", 
    RowBox[{"{", 
     RowBox[{"R_", ",", "t_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Composition", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TransformationFunction", "@", "K"}], ",", "\[IndentingNewLine]", 
    RowBox[{"TransformationFunction", "@", 
     RowBox[{"ArrayFlatten", "@", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"R", ",", "t"}], "}"}], "}"}]}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8959181887538815`*^9, 3.8959181962517796`*^9}},
 CellLabel->
  "In[1422]:=",ExpressionUUID->"9d486429-ba24-47d6-9b03-45f9fbe9b27a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PointsScale", "[", 
   RowBox[{"img_Image", ",", 
    RowBox[{"target_", ":", 
     RowBox[{"(", 
      RowBox[{"_Integer", "|", 
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer"}], "}"}]}], ")"}]}]}], "]"}], ":=", 
  RowBox[{"ScalingTransform", "[", 
   RowBox[{"img", "/", "target"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PointsScale", "[", 
   RowBox[{"img_Image", ",", 
    RowBox[{"target", ":", 
     RowBox[{"(", 
      RowBox[{"_Real", "|", 
       RowBox[{"{", 
        RowBox[{"_Real", ",", "_Real"}], "}"}]}], ")"}]}]}], "]"}], ":=", 
  RowBox[{"ScalingTransform", "[", 
   RowBox[{"img", "*", "target"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PointsScale", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_Integer", ",", "y_Integer"}], "}"}], ",", 
    RowBox[{"target_", ":", 
     RowBox[{"(", 
      RowBox[{"_Integer", "|", 
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer"}], "}"}]}], ")"}]}]}], "]"}], ":=", 
  RowBox[{"ScalingTransform", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}], "/", "target"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PointsScale", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_Integer", ",", "y_Integer"}], "}"}], ",", 
    RowBox[{"target", ":", 
     RowBox[{"(", 
      RowBox[{"_Real", "|", 
       RowBox[{"{", 
        RowBox[{"_Real", ",", "_Real"}], "}"}]}], ")"}]}]}], "]"}], ":=", 
  RowBox[{"ScalingTransform", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}], "*", "target"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8956885499909744`*^9, 3.895688578395339*^9}, 
   3.8959437139181976`*^9},ExpressionUUID->"a8d74db2-c016-46e3-a329-\
5c8c1c62a200"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CreateCube", "[", 
   RowBox[{"fn_", ",", 
    RowBox[{"flipp_", ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cubeList", ",", "dn", ",", "up"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cubeList", "=", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], 
       RowBox[{"(*", "vertical", "*)"}], "\[IndentingNewLine]", "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"flipp", ",", 
       RowBox[{"cubeList", "=", 
        RowBox[{"cubeList", "*", 
         RowBox[{"Threaded", "@", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", 
            RowBox[{"-", "1"}]}], "}"}]}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["dn", "\"\<00\>\""], ",", 
        SubscriptBox["dn", "\"\<10\>\""], ",", 
        SubscriptBox["dn", "\"\<01\>\""], ",", 
        SubscriptBox["dn", "\"\<11\>\""], ",", "\[IndentingNewLine]", 
        SubscriptBox["up", "\"\<00\>\""], ",", 
        SubscriptBox["up", "\"\<10\>\""], ",", 
        SubscriptBox["up", "\"\<01\>\""], ",", 
        SubscriptBox["up", "\"\<11\>\""]}], "\[IndentingNewLine]", "}"}], "=", 
      RowBox[{"Flatten", "/@", 
       RowBox[{"SplitMatrix", "[", 
        RowBox[{
         RowBox[{"fn", "@", "cubeList"}], ",", "\"\<col\>\""}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"Green", ",", "\[IndentingNewLine]", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<00\>\""], ",", 
          SubscriptBox["dn", "\"\<10\>\""]}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<01\>\""], ",", 
          SubscriptBox["dn", "\"\<11\>\""]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "Red", ",", "\[IndentingNewLine]", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<00\>\""], ",", 
          SubscriptBox["dn", "\"\<01\>\""]}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<10\>\""], ",", 
          SubscriptBox["dn", "\"\<11\>\""]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "Blue", ",", "\[IndentingNewLine]", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<00\>\""], ",", 
          SubscriptBox["up", "\"\<00\>\""]}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<10\>\""], ",", 
          SubscriptBox["up", "\"\<10\>\""]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<01\>\""], ",", 
          SubscriptBox["up", "\"\<01\>\""]}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dn", "\"\<11\>\""], ",", 
          SubscriptBox["up", "\"\<11\>\""]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "Yellow", ",", "Thin", ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["up", "\"\<00\>\""], ",", 
          SubscriptBox["up", "\"\<10\>\""]}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["up", "\"\<01\>\""], ",", 
          SubscriptBox["up", "\"\<11\>\""]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["up", "\"\<00\>\""], ",", 
          SubscriptBox["up", "\"\<01\>\""]}], "}"}], "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["up", "\"\<10\>\""], ",", 
          SubscriptBox["up", "\"\<11\>\""]}], "}"}], "]"}]}], 
      "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",ExpressionUUID->"c3d53937-a5c0-47a2-89f0-234d9f02f8d9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HomographyNormalization", "[", "pointsImage_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Composition", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ScalingTransform", "[", " ", 
      RowBox[{"1", "/", 
       RowBox[{"MeanDeviation", "@", "pointsImage"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"TranslationTransform", "[", 
      RowBox[{"-", 
       RowBox[{"Mean", "@", "pointsImage"}]}], "]"}]}], "\[IndentingNewLine]",
     "]"}], "//", "N"}]}]], "Input",
 CellChangeTimes->{{3.895944092478541*^9, 3.8959441294332128`*^9}},
 CellLabel->
  "In[1694]:=",ExpressionUUID->"0fd02123-25a7-4886-b834-49c6678afaa7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindHomography", "[", 
   RowBox[{
   "pointsImage_", ",", "pointsWorld_", ",", "K_", ",", "\"\<Solve\>\""}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"image", "=", "pointsImage"}], ",", 
      RowBox[{"world", "=", "pointsWorld"}], ",", "Knorm", ",", "A", ",", "H",
       ",", "Hnorm", ",", "Hsolve", ",", "h", ",", "hvec", ",", "M", ",", 
      "pntScale"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Knorm", "=", 
      RowBox[{"InverseFunction", "@", 
       RowBox[{"TransformationFunction", "[", "K", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{"Knorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Hnorm", "=", 
      RowBox[{"HomographyNormalization", "[", "image", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{"Hnorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", "[", 
       RowBox[{"{", 
        RowBox[{"X_", ",", "Y_", ",", "Z_", ",", "x_", ",", "y_"}], "}"}], 
       "]"}], ":=", 
      RowBox[{"Join", "@@@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"x", "*", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}], ",", 
           RowBox[{"y", "*", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}]}], "}"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"hvec", "=", 
      RowBox[{"Array", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["h", "##"], "&"}], ",", "9"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{
       RowBox[{"M", "/@", 
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{"world", ",", "image"}], "}"}], "}"}], "]"}]}], "//", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Hsolve", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Solve", "[", 
           RowBox[{
            RowBox[{"And", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"A", ".", "#"}], "==", "0"}], ",", 
              RowBox[{
               RowBox[{"Norm", "[", "#", "]"}], "==", "1"}]}], "]"}], ",", 
            "#"}], "]"}], "&"}], "@", "hvec"}], "//", "First"}], "//", 
       "N"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"hvec", ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "3"}], "}"}]}], "]"}], "/.", "Hsolve"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"PointsProjection", "[", 
      RowBox[{"K", ",", 
       RowBox[{"DecomposeHomography", "[", 
        RowBox[{"H", ",", "Hnorm"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.89594394947727*^9, 3.895944049517105*^9}, 
   3.8959441585319138`*^9, {3.8959442431190944`*^9, 3.895944248937214*^9}, {
   3.895944290746358*^9, 3.895944302691334*^9}, {3.8959446493417735`*^9, 
   3.8959446547450795`*^9}, 
   3.8959484257061477`*^9},ExpressionUUID->"08a3b405-2f6b-4600-a727-\
26cd19579d6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindHomography", "[", 
   RowBox[{
   "pointsImage_", ",", "pointsWorld_", ",", "K_", ",", "\"\<SVD\>\""}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"image", "=", "pointsImage"}], ",", 
      RowBox[{"world", "=", "pointsWorld"}], ",", "\[IndentingNewLine]", 
      "USV", ",", "H", ",", "M", ",", "A", ",", "Knorm", ",", "Hnorm"}], 
     "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Knorm", "=", 
      RowBox[{"InverseFunction", "@", 
       RowBox[{"TransformationFunction", "[", "K", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{"Knorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Hnorm", "=", 
      RowBox[{"HomographyNormalization", "[", "image", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{"Hnorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", "[", 
       RowBox[{"{", 
        RowBox[{"X_", ",", "Y_", ",", "Z_", ",", "x_", ",", "y_"}], "}"}], 
       "]"}], ":=", 
      RowBox[{"Join", "@@@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"x", "*", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"-", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}], ",", 
           RowBox[{"y", "*", 
            RowBox[{"{", 
             RowBox[{"X", ",", "Y", ",", "1"}], "}"}]}]}], "}"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{"M", "/@", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{"world", ",", "image"}], "}"}], "}"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"A", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"USV", "=", 
      RowBox[{"SingularValueDecomposition", "[", "A", "]"}]}], ";", 
     RowBox[{"H", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"USV", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "All", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"PointsProjection", "[", 
      RowBox[{"K", ",", 
       RowBox[{"DecomposeHomography", "[", 
        RowBox[{"H", ",", "Hnorm"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8959453853839474`*^9, 3.8959454053675137`*^9}, {
   3.895945466846372*^9, 3.8959455316902237`*^9}, 3.8959455670615077`*^9, {
   3.8959456103900447`*^9, 3.89594569235998*^9}, {3.895945758457636*^9, 
   3.895945806993154*^9}, {3.8959483463086452`*^9, 3.89594836277264*^9}, {
   3.895948410803348*^9, 
   3.8959484143423595`*^9}},ExpressionUUID->"57035cdf-1ef4-424d-bc51-\
d43045853ccd"],

Cell["\<\
USV=SingularValueDecomposition[worldNorm.worldNorm\[Transpose]];
(USV[[2,3,3]]/USV[[2,2,2]]  <1e-3 And Num<5 
conditions if points are on a plane\
\>", "Text",
 CellChangeTimes->{{3.8959476267737737`*^9, 3.8959476596909637`*^9}, {
  3.8959477325203657`*^9, 
  3.895947735694579*^9}},ExpressionUUID->"aedaa600-e98a-41ae-b235-\
cde23d0448fc"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples 2", "Subsubsection",
 CellChangeTimes->{{3.8956677211349134`*^9, 3.89566772149233*^9}, {
   3.8957256739103117`*^9, 3.895725675102476*^9}, 3.8959436594006395`*^9, 
   3.8959466811231623`*^9},ExpressionUUID->"00bba445-a1d0-4a9a-b119-\
3af5ec70b21b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"points3d", "=", 
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "\n", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", "\n", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", "\n", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"z", " ", "is", " ", "always", " ", "0"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"pointsIm", "=", 
   RowBox[{"{", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"based", " ", "on", " ", "224", "x224", " ", "image"}], "*)"}], 
    "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"88", ",", "73"}], "}"}], ",", "\n", 
     RowBox[{"{", 
      RowBox[{"167", ",", "68"}], "}"}], ",", "\n", 
     RowBox[{"{", 
      RowBox[{"170", ",", "162"}], "}"}], ",", "\n", 
     RowBox[{"{", 
      RowBox[{"95", ",", "173"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalKappa]", "=", 
   RowBox[{"(", GridBox[{
      {"756", "0", "378"},
      {"0", "756", "504"},
      {"0", "0", "1"}
     }], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "camera", " ", "matrix", " ", "for", " ", "image", " ", "size", " ", 
    "1008", "x756"}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.895725771498971*^9, 3.895725775583826*^9}, {
  3.8957260514346886`*^9, 3.895726078292757*^9}, {3.8959447492990046`*^9, 
  3.8959448061530457`*^9}, {3.8959448395607705`*^9, 3.895944856501605*^9}, {
  3.895944947571419*^9, 
  3.8959449671575537`*^9}},ExpressionUUID->"7445c46f-430d-4723-af28-\
9e243e46603a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"scale", " ", "pints", " ", "to", " ", "1008", "x756"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"pointsIm756", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"PointsScale", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1008", ",", "756"}], "}"}], ",", "224"}], "]"}], "@", 
     "pointsIm"}], "//", "N"}]}]}]], "Input",
 CellChangeTimes->{{3.8959450252894983`*^9, 3.8959450515730486`*^9}, {
  3.8959460586981564`*^9, 
  3.895946094984813*^9}},ExpressionUUID->"ccc31021-d748-469b-940a-\
bd0d25ee16e5"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"396.`", "246.375`"},
     {"751.5`", "229.5`"},
     {"765.`", "546.75`"},
     {"427.5`", "583.875`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{{3.8959450321762753`*^9, 3.89594505234384*^9}, 
   3.8959460708123507`*^9},
 CellLabel->
  "Out[1719]=",ExpressionUUID->"c210b46c-53f1-4b69-8a65-835e14e3dfde"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FindHomography", "[", "\[IndentingNewLine]", 
   RowBox[{
   "pointsIm756", ",", "points3d", ",", "\[IndentingNewLine]", 
    "\[CapitalKappa]", ",", "\"\<Solve\>\""}], "]"}], "@", "points3d", 
  " "}]], "Input",
 CellChangeTimes->{{3.895944701351677*^9, 3.895944702895234*^9}, {
   3.8959448717226677`*^9, 3.8959448792319207`*^9}, {3.8959449846110516`*^9, 
   3.8959450065069666`*^9}, {3.895945062108856*^9, 3.895945097144695*^9}, {
   3.8959451773199167`*^9, 3.895945277547036*^9}, 3.895945315831942*^9, {
   3.895946112810297*^9, 3.89594612107498*^9}},
 CellLabel->
  "In[1720]:=",ExpressionUUID->"cc8b1c1e-5c7c-4d95-a786-9574b26231c5"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"396.`", "246.37500000000009`"},
     {"733.6081371873156`", "230.34929728541232`"},
     {"748.7847500498543`", "566.8366836720463`"},
     {"429.29684983500835`", "603.1269625179469`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{{3.895945173310343*^9, 3.8959452784912715`*^9}, 
   3.8959453169920573`*^9, 3.8959461269506025`*^9},
 CellLabel->
  "Out[1720]=",ExpressionUUID->"b8440367-3097-40f3-bc74-8f70f1f39ca4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FindHomography", "[", "\[IndentingNewLine]", 
   RowBox[{
   "pointsIm756", ",", "points3d", ",", "\[IndentingNewLine]", 
    "\[CapitalKappa]", ",", "\"\<SVD\>\""}], "]"}], "@", "points3d", 
  " "}]], "Input",
 CellChangeTimes->{{3.8959459390561104`*^9, 3.8959459398396683`*^9}, {
  3.8959461732379193`*^9, 3.8959461842381434`*^9}},
 CellLabel->
  "In[1736]:=",ExpressionUUID->"426ef50a-5d3b-4ae5-ae27-5dbd8c2612dc"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"395.9999999999999`", "246.37500000000009`"},
     {"733.6081371873156`", "230.3492972854122`"},
     {"748.7847500498543`", "566.8366836720462`"},
     {"429.2968498350083`", "603.1269625179469`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.8959459411258807`*^9, 3.8959460432635956`*^9, 
  3.8959461865757666`*^9, 3.8959483963502245`*^9},
 CellLabel->
  "Out[1736]=",ExpressionUUID->"dee4b77c-2677-4b26-8a61-6b6c890751c5"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simplification", "Subsubsection",
 CellChangeTimes->{{3.8959479370102243`*^9, 
  3.895947942911736*^9}},ExpressionUUID->"2306acda-d04d-4441-83dc-\
962138ffb0e9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pntScale", "=", 
   RowBox[{"PointsScale", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ImageDimensions", "@", "img"}], "/", "4"}], ",", "224"}], 
    "]"}]}], ";", "\[IndentingNewLine]", 
  RowBox[{"image", "=", 
   RowBox[{
    RowBox[{"pntScale", "@", "image"}], "//", "N"}]}], ";", 
  "\[IndentingNewLine]", 
  RowBox[{"Knorm", "=", 
   RowBox[{"InverseFunction", "@", 
    RowBox[{"TransformationFunction", "[", "K", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"image", "=", 
    RowBox[{"Knorm", "@", "image"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"addZ1", "=", 
    RowBox[{"TranslationTransform", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"world", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "3"}], "]"}], "]"}], "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"world", "=", 
   RowBox[{"addZ1", "@", "world"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Hnorm", "=", 
   RowBox[{"HomographyNormalization", "[", "image", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"image", "=", 
    RowBox[{"Hnorm", "@", "image"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"bad", " ", "rottation"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Composition", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TransformationFunction", "[", "K", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"InverseFunction", "@", "Hnorm"}], ",", "\[IndentingNewLine]", 
     RowBox[{"TransformationFunction", "[", "H", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"TransformationFunction", "@", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}], "]"}]}], ",", "\[IndentingNewLine]", 
     "addZ1"}], "\[IndentingNewLine]", "]"}], "@", "points3d"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"same", " ", "as"}], ",", " ", 
    RowBox[{"but", " ", "correct", " ", "rottation"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PointsProjection", "[", 
   RowBox[{"K", ",", 
    RowBox[{"DecomposeHomography", "[", 
     RowBox[{"H", ",", "Hnorm"}], "]"}]}], "]"}], "@", "points3d"}]}], "Input",
 CellChangeTimes->{{3.89594778596988*^9, 3.895947786517168*^9}, {
  3.895947826325601*^9, 3.8959478274829826`*^9}, {3.895947865024528*^9, 
  3.8959479112362385`*^9}, {3.895948170360277*^9, 3.895948235126642*^9}, {
  3.8959487277214613`*^9, 
  3.895948728778637*^9}},ExpressionUUID->"8eea1146-91ac-4802-a814-\
6e6014437957"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bad Examples", "Subsubsection",
 CellChangeTimes->{{3.8956677211349134`*^9, 3.89566772149233*^9}, {
   3.8957256739103117`*^9, 3.895725675102476*^9}, 3.8959436594006395`*^9, {
   3.8959466811231623`*^9, 3.8959467026029577`*^9}, {3.8959470811067376`*^9, 
   3.895947085477065*^9}},ExpressionUUID->"3361bc7e-9b5b-42c2-9568-\
44c3d0999b82"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"image", "=", "pointsIm"}], ",", 
     RowBox[{"world", "=", "points3d"}], ",", "Hnorm", ",", "Hinv", ",", 
     "\[IndentingNewLine]", "imageNorm", ",", "mean", ",", "colmean", ",", 
     "imageNorm2", ",", "L", ",", "USV", ",", "H", ",", "M", ",", "A"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"world", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}], "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"mean", "=", 
      RowBox[{"Mean", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"imageNorm", "=", 
      RowBox[{"image", "-", 
       RowBox[{"Threaded", "@", "mean"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"colmean", "=", 
      RowBox[{"Mean", "@", 
       RowBox[{"Abs", "@", "imageNorm"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Hnorm", "=", 
      RowBox[{
       RowBox[{"Composition", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ScalingTransform", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], "/", "colmean"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"TranslationTransform", "[", 
          RowBox[{"-", "mean"}], "]"}]}], "\[IndentingNewLine]", "]"}], "//", 
       "N"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Hinv", " ", "=", " ", 
      RowBox[{"InverseFunction", "@", "Hnorm"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"imageNorm2", "=", 
      RowBox[{"Hnorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"L", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "9", "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"4", "*", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"imageNorm2", "=", 
      RowBox[{"ToHom", "@", "imageNorm2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"based", " ", "on", " ", 
        RowBox[{"https", ":"}]}], "//", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"github", ".", "com"}], "/", "fragofer"}], "/", 
            "TOOLBOX_calib"}], "/", "blob"}], "/", 
          "eb55d528117d664230684d3a5852765b84e7af64"}], "/", 
         RowBox[{"compute_homography", ".", "m"}]}], "#L78"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"1", ";;", "3"}], ",", 
         RowBox[{"1", ";;", "8", ";;", "2"}]}], "]"}], "]"}], "=", 
      RowBox[{"world", "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"4", ";;", "6"}], ",", 
         RowBox[{"2", ";;", "8", ";;", "2"}]}], "]"}], "]"}], "=", 
      RowBox[{"world", "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"7", ";;", "9"}], ",", 
         RowBox[{"1", ";;", "8", ";;", "2"}]}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{"-", "imageNorm2"}], "*", "world"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "All"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"7", ";;", "9"}], ",", 
         RowBox[{"2", ";;", "8", ";;", "2"}]}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{"-", "imageNorm2"}], "*", "world"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "All"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"USV", "=", 
      RowBox[{"SingularValueDecomposition", "[", 
       RowBox[{"L", "\[Transpose]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"USV", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "All", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "3"}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Hinv", "[", "\"\<TransformationMatrix\>\"", "]"}], ".", "H", 
        ".", 
        RowBox[{"world", "\[Transpose]"}]}], "//", "Transpose"}], "//", 
      "FromHom"}], "*)"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Hinv", "[", "\"\<TransformationMatrix\>\"", "]"}], ".", "H", 
     ".", 
     RowBox[{"world", "\[Transpose]"}]}]}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"doesn", "'"}], " ", "work"}], "*)"}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.8957256823153934`*^9, 3.8957256941350946`*^9}, {
   3.89573622186242*^9, 3.895736259687792*^9}, {3.8957362944735537`*^9, 
   3.8957363027667913`*^9}, {3.8957370243391323`*^9, 3.895737058101051*^9}, 
   3.8957371025860934`*^9, {3.8957379908632917`*^9, 3.895738052074518*^9}, {
   3.8957381378831873`*^9, 3.8957381411841707`*^9}, {3.8957381992290983`*^9, 
   3.895738244102143*^9}, {3.8957410583799725`*^9, 3.895741059415978*^9}, {
   3.89574121020224*^9, 3.8957412251489754`*^9}, {3.895741297134255*^9, 
   3.8957415903217793`*^9}, {3.8957417529281*^9, 3.8957419667371187`*^9}, {
   3.895741997775671*^9, 3.895742031240389*^9}, {3.8957421039294558`*^9, 
   3.895742154693153*^9}, {3.89574219314475*^9, 3.8957423436565013`*^9}, {
   3.8957426180462804`*^9, 3.8957428557411766`*^9}, {3.8957429430293865`*^9, 
   3.895742980153164*^9}, {3.8957430615757513`*^9, 3.8957430917438755`*^9}, {
   3.895743127567113*^9, 3.8957431542212*^9}, {3.8957535802382965`*^9, 
   3.895753666993927*^9}, {3.895753706241831*^9, 3.895753750709099*^9}, {
   3.8957538473807364`*^9, 3.895753851256141*^9}, {3.8957538834757576`*^9, 
   3.895753892088035*^9}, {3.895754025485261*^9, 3.8957540392905426`*^9}, {
   3.895754070045148*^9, 3.8957541387954254`*^9}, {3.895754498910552*^9, 
   3.8957545037455597`*^9}, {3.8957545520969687`*^9, 3.89575458451556*^9}, {
   3.8957581344055862`*^9, 3.8957581422002077`*^9}, {3.8957581724035215`*^9, 
   3.895758268894947*^9}, {3.895758457806328*^9, 3.895758550400714*^9}, {
   3.8957637334323635`*^9, 3.8957637472611303`*^9}, {3.895763791799036*^9, 
   3.895763822104855*^9}, {3.895763856640216*^9, 3.8957638731655607`*^9}, {
   3.895763905081601*^9, 3.895763977595434*^9}, {3.8957640323793354`*^9, 
   3.895764066574466*^9}, {3.895764104016572*^9, 3.89576414731115*^9}, {
   3.8957642047831526`*^9, 3.8957643206600857`*^9}, {3.895764355817109*^9, 
   3.8957643969907336`*^9}, {3.895764465502994*^9, 3.895764477790436*^9}, {
   3.895764573542982*^9, 3.89576476299045*^9}, {3.8957648159419165`*^9, 
   3.8957648392590375`*^9}, {3.895764882310994*^9, 3.8957650112873163`*^9}, {
   3.8957654838122897`*^9, 3.895765555366639*^9}, {3.895765605103558*^9, 
   3.8957656251494856`*^9}, {3.8957656614825983`*^9, 
   3.8957657365623226`*^9}, {3.8957657932764716`*^9, 
   3.8957658818860836`*^9}, {3.895765991763332*^9, 3.89576601205746*^9}, {
   3.89576605838221*^9, 3.8957661372130394`*^9}, {3.895766172107214*^9, 
   3.8957662442388363`*^9}, {3.8957668268300643`*^9, 3.895766831710392*^9}, {
   3.895771412277878*^9, 3.895771422340392*^9}, 3.8957714941946964`*^9, {
   3.8958242919855256`*^9, 3.895824299281435*^9}, {3.895946741199054*^9, 
   3.89594679744956*^9}, {3.895946849268881*^9, 3.895946888673567*^9}, {
   3.895946949316611*^9, 3.8959470580233946`*^9}},
 CellLabel->
  "In[1728]:=",ExpressionUUID->"8f23b11d-0382-4e5a-a1fb-0aaa715246e2"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"91.92388155425118`", "1.4210854715202004`*^-14", "0.`", 
      "91.92388155425117`"},
     {"84.14570696119917`", "1.4210854715202004`*^-14", "0.`", 
      "84.14570696119915`"},
     {"0.7071067811865476`", "1.1102230246251565`*^-16", "0.`", 
      "0.7071067811865475`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{
  3.8959468099988165`*^9, 3.8959468586625032`*^9, 3.8959468895959272`*^9, {
   3.8959469580301027`*^9, 3.8959469726983232`*^9}, 3.895947021187089*^9, 
   3.895947093327979*^9},
 CellLabel->
  "Out[1728]=",ExpressionUUID->"a841443a-19bb-4ce1-8b13-6fa8c0cf7a2c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"image", "=", "pointsIm"}], ",", 
     RowBox[{"world", "=", "points3d"}], ",", "Hnorm", ",", "Hinv", ",", 
     "\[IndentingNewLine]", "imageNorm", ",", "mean", ",", "colmean", ",", 
     "imageNorm2", ",", "L", ",", "USV", ",", "H", ",", "M", ",", "A", ",", 
     "worldNorm"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"world", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}], "=", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"image", "=", 
      RowBox[{"ToHom", "@", "image"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mean", "=", 
     RowBox[{"Mean", "@", "image"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"imageNorm", "=", 
     RowBox[{"image", "-", 
      RowBox[{"Threaded", "@", "mean"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"colmean", "=", 
     RowBox[{"Mean", "@", 
      RowBox[{"Abs", "@", "imageNorm"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"worldNorm", "=", 
     RowBox[{"world", "-", 
      RowBox[{"Threaded", "@", 
       RowBox[{"Mean", "@", "world"}]}]}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"USV", "=", 
       RowBox[{"SingularValueDecomposition", "[", "A", "]"}]}], ";"}], "*)"}],
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"USV", "=", 
     RowBox[{"SingularValueDecomposition", "[", 
      RowBox[{"worldNorm", ".", 
       RowBox[{"worldNorm", "\[Transpose]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"USV", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "3", ",", "3"}], "]"}], "]"}], "/", 
       RowBox[{"USV", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "2", ",", "2"}], "]"}], "]"}]}], "  ", "<", 
      RowBox[{
       RowBox[{"1", "e"}], "-", 
       RowBox[{"3", " ", "And", " ", "Num"}]}], "<", "5"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"USV", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "\[Transpose]"}], "[", 
       RowBox[{"[", 
        RowBox[{"3", ",", 
         RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "//", "Norm"}], "//", 
     "N"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Det", "[", 
     RowBox[{
      RowBox[{"USV", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "\[Transpose]"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"USV", "[", 
      RowBox[{"[", "3", "]"}], "]"}], "\[Transpose]"}], ";", 
    "\[IndentingNewLine]", "\n", 
    RowBox[{"FindFit", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Prime", "[", "x", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "20"}], "}"}]}], "]"}], ",", 
      RowBox[{"a", " ", "x", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"b", "+", 
         RowBox[{"c", " ", "x"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", "x"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"ArrayFlatten", "[", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"world", ",", "image"}], "}"}], "}"}], "]"}]}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8957256823153934`*^9, 3.8957256941350946`*^9}, {
   3.89573622186242*^9, 3.895736259687792*^9}, {3.8957362944735537`*^9, 
   3.8957363027667913`*^9}, {3.8957370243391323`*^9, 3.895737058101051*^9}, 
   3.8957371025860934`*^9, {3.8957379908632917`*^9, 3.895738052074518*^9}, {
   3.8957381378831873`*^9, 3.8957381411841707`*^9}, {3.8957381992290983`*^9, 
   3.895738244102143*^9}, {3.8957410583799725`*^9, 3.895741059415978*^9}, {
   3.89574121020224*^9, 3.8957412251489754`*^9}, {3.895741297134255*^9, 
   3.8957415903217793`*^9}, {3.8957417529281*^9, 3.8957419667371187`*^9}, {
   3.895741997775671*^9, 3.895742031240389*^9}, {3.8957421039294558`*^9, 
   3.895742154693153*^9}, {3.89574219314475*^9, 3.8957423436565013`*^9}, {
   3.8957426180462804`*^9, 3.8957428557411766`*^9}, {3.8957429430293865`*^9, 
   3.895742980153164*^9}, {3.8957430615757513`*^9, 3.8957430917438755`*^9}, {
   3.895743127567113*^9, 3.8957431542212*^9}, {3.8957535802382965`*^9, 
   3.895753666993927*^9}, {3.895753706241831*^9, 3.895753750709099*^9}, {
   3.8957538473807364`*^9, 3.895753851256141*^9}, {3.8957538834757576`*^9, 
   3.895753892088035*^9}, {3.895754025485261*^9, 3.8957540392905426`*^9}, {
   3.895754070045148*^9, 3.8957541387954254`*^9}, {3.895754498910552*^9, 
   3.8957545037455597`*^9}, {3.8957545520969687`*^9, 3.89575458451556*^9}, {
   3.8957581344055862`*^9, 3.8957581422002077`*^9}, {3.8957581724035215`*^9, 
   3.895758268894947*^9}, {3.895758457806328*^9, 3.895758550400714*^9}, {
   3.8957637334323635`*^9, 3.8957637472611303`*^9}, {3.895763791799036*^9, 
   3.895763822104855*^9}, {3.895763856640216*^9, 3.8957638731655607`*^9}, {
   3.895763905081601*^9, 3.895763977595434*^9}, {3.8957640323793354`*^9, 
   3.895764066574466*^9}, {3.895764104016572*^9, 3.89576414731115*^9}, {
   3.8957642047831526`*^9, 3.8957643206600857`*^9}, {3.895764355817109*^9, 
   3.8957643969907336`*^9}, {3.895764465502994*^9, 3.895764477790436*^9}, {
   3.895764573542982*^9, 3.89576476299045*^9}, {3.8957648159419165`*^9, 
   3.8957648392590375`*^9}, {3.895764882310994*^9, 3.8957650112873163`*^9}, {
   3.8957654838122897`*^9, 3.895765555366639*^9}, {3.895765605103558*^9, 
   3.8957656251494856`*^9}, {3.8957656614825983`*^9, 
   3.8957657365623226`*^9}, {3.8957657932764716`*^9, 
   3.8957658818860836`*^9}, {3.895765991763332*^9, 3.89576601205746*^9}, {
   3.89576605838221*^9, 3.8957661372130394`*^9}, {3.895766172107214*^9, 
   3.8957662442388363`*^9}, {3.8957668268300643`*^9, 3.895766831710392*^9}, {
   3.8957670635145063`*^9, 3.8957670926420903`*^9}, {3.8957673326183405`*^9, 
   3.895767605173314*^9}, {3.8957676361044717`*^9, 3.8957676891940937`*^9}, {
   3.8957677723269424`*^9, 3.8957677940516605`*^9}, {3.8957678411887493`*^9, 
   3.895767915580106*^9}, {3.8957686265411158`*^9, 3.895768659209772*^9}, {
   3.8957691890690513`*^9, 3.8957691991894226`*^9}},
 CellLabel->
  "In[677]:=",ExpressionUUID->"c93b649d-0486-4c56-bace-65c942df531b"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"R", ",", "t", ",", 
      RowBox[{"K", "=", 
       RowBox[{"(", GridBox[{
          {"756", "0", "378"},
          {"0", "756", "504"},
          {"0", "0", "1"}
         }], ")"}]}], ",", 
      RowBox[{"image", "=", "pointsIm"}], ",", 
      RowBox[{"world", "=", "points3d"}], ",", "Knorm", ",", "A", ",", "H", 
      ",", "Hnorm", ",", "Hsolve", ",", "h", ",", "hvec", ",", "M", ",", 
      "pntScale", ",", "X", ",", "Y", ",", "Z", ",", "x", ",", "y"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pntScale", "=", 
      RowBox[{"PointsScale", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ImageDimensions", "@", "img"}], "/", "4"}], ",", "224"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{
       RowBox[{"pntScale", "@", "image"}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Knorm", "=", 
      RowBox[{"InverseFunction", "@", 
       RowBox[{"TransformationFunction", "[", "K", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{"Knorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Hnorm", "=", 
      RowBox[{"HomographyNormalization", "[", "image", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"image", "=", 
      RowBox[{"Hnorm", "@", "image"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"hvec", "=", 
      RowBox[{"Array", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["h", "##"], "&"}], ",", "9"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Hsolve", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"FindFit", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayFlatten", "[", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"world", ",", "image", ",", 
              RowBox[{"List", "/@", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}]}], "}"}],
             "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "X"}], ",", 
                RowBox[{"-", "Y"}], ",", 
                RowBox[{"-", "1"}], ",", "0", ",", "0", ",", "0", ",", 
                RowBox[{"x", " ", "X"}], ",", 
                RowBox[{"x", " ", "Y"}], ",", "x"}], "}"}], ".", "#"}], "+", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", 
                RowBox[{"-", "X"}], ",", 
                RowBox[{"-", "Y"}], ",", 
                RowBox[{"-", "1"}], ",", 
                RowBox[{"X", " ", "y"}], ",", 
                RowBox[{"y", " ", "Y"}], ",", "y"}], "}"}], ".", "#"}]}], ",",
             "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Norm", "[", "#", "]"}], "==", "1"}]}], "}"}], ",", "#", 
          ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"X", ",", "Y", ",", "Z", ",", "x", ",", "y"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Method", "->", "Automatic"}]}], "\[IndentingNewLine]", 
         "]"}], "&"}], "@", "hvec"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"hvec", ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "3"}], "}"}]}], "]"}], "/.", "Hsolve"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"PointsProjection", "[", 
      RowBox[{"K", ",", 
       RowBox[{"DecomposeHomography", "[", 
        RowBox[{"H", ",", "Hnorm"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}], "@", "points3d"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"incorect", " ", "rotation"}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.8959471496420565`*^9, 3.8959471935857067`*^9}, {
  3.8959472325316243`*^9, 
  3.8959473111136456`*^9}},ExpressionUUID->"8879d4a6-fb71-4edc-8d6e-\
eeecdf518c3e"],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"408.33963497548586`", "234.71644876887544`"},
     {"650.8031583808446`", "463.808753016046`"},
     {"789.4362676033555`", "594.7867849650626`"},
     {"576.9526345615767`", "394.0235617950719`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.895947194874729*^9, 3.8959472987955313`*^9},
 CellLabel->
  "Out[1730]=",ExpressionUUID->"c4d9adff-ce10-4e04-ba0f-461daf848cc3"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{721.1999999999999, 574.8},
WindowMargins->{{33.6, Automatic}, {Automatic, 0}},
FrontEndVersion->"13.2 for Microsoft Windows (64-bit) (January 30, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e8e8c826-61c6-4ac7-9fa9-96cf9191eec3"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 97, 0, 83, "Section",ExpressionUUID->"561c775e-c42c-462e-876e-a8fca401d9b5"],
Cell[CellGroupData[{
Cell[702, 26, 85, 0, 67, "Subsection",ExpressionUUID->"62375e9d-8d93-422f-8995-3699321aa997"],
Cell[790, 28, 2239, 70, 323, "Code",ExpressionUUID->"2b19e1db-74ed-4af5-a399-f5cad55e88b8"],
Cell[CellGroupData[{
Cell[3054, 102, 91, 0, 56, "Subsubsection",ExpressionUUID->"cc30baeb-0c25-44c8-8628-2b3ecd0ff798"],
Cell[3148, 104, 3659, 111, 553, "Text",ExpressionUUID->"2f63ad15-4a5a-4c99-85b2-fb4d557a18cc"],
Cell[6810, 217, 90, 0, 43, "Text",ExpressionUUID->"d645b441-9d00-47ca-b6d2-e7e6599f122d"],
Cell[6903, 219, 3468, 111, 199, "Text",ExpressionUUID->"0fa720d2-1ce4-4230-90c8-327b5ce252f2"],
Cell[10374, 332, 92, 0, 43, "Text",ExpressionUUID->"eafecef0-8f8b-4a20-9edd-383370317d1d"],
Cell[10469, 334, 3930, 116, 124, "Text",ExpressionUUID->"45926a3f-4539-4184-aa8e-ed7bbe7b57c4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14436, 455, 88, 0, 56, "Subsubsection",ExpressionUUID->"caff42f6-3568-4329-b01f-ee4c970b2fb1"],
Cell[CellGroupData[{
Cell[14549, 459, 1928, 55, 104, "Input",ExpressionUUID->"328a2fa2-5980-4c4d-b661-eb8352852473",
 InitializationCell->False],
Cell[16480, 516, 720, 19, 81, "Output",ExpressionUUID->"a7e473c2-5a49-463a-8b4b-fc1f279b6186"]
}, Open  ]],
Cell[CellGroupData[{
Cell[17237, 540, 495, 13, 37, "Input",ExpressionUUID->"4b36600d-05e2-4213-a7ad-b6f0eca85a1e"],
Cell[17735, 555, 2114, 64, 97, "Output",ExpressionUUID->"32ff4376-dbfd-4c04-90a4-84b20171f36b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19886, 624, 1466, 39, 108, "Input",ExpressionUUID->"55bd793d-9a01-4248-8765-3e6d5bfc060f"],
Cell[21355, 665, 2509, 76, 106, "Output",ExpressionUUID->"ece4755f-57c2-466b-b808-a0f317ccb06a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23901, 746, 1912, 59, 110, "Input",ExpressionUUID->"3e0f24ac-f0a7-42c2-b80c-fcbfa6786400"],
Cell[25816, 807, 1403, 43, 87, "Output",ExpressionUUID->"ac8ceb3f-930b-47ca-91e6-d723dd83fca6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27256, 855, 1658, 46, 82, "Input",ExpressionUUID->"ed8a98e2-c6fa-4910-8466-f0cbf610c11c"],
Cell[28917, 903, 1038, 32, 93, "Output",ExpressionUUID->"5192bf2c-70e5-4ac3-9dd4-6b691f924d4e"]
}, Open  ]],
Cell[29970, 938, 894, 24, 175, "Input",ExpressionUUID->"cc91f33f-efc7-49ed-b921-af642849e3d8",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[30889, 966, 1792, 51, 111, "Input",ExpressionUUID->"8cb27f81-78db-4e34-9b8f-630d467dea2f"],
Cell[32684, 1019, 1062, 32, 63, "Output",ExpressionUUID->"ee34b20c-114d-4068-930b-cc412d6249d3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[33783, 1056, 1720, 52, 202, "Input",ExpressionUUID->"98a4fb25-04c7-4434-a046-30fcf0604816"],
Cell[35506, 1110, 2145, 63, 61, "Output",ExpressionUUID->"ecabfa65-0a35-43f1-947d-9c7722db7cd7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37688, 1178, 362, 11, 58, "Input",ExpressionUUID->"f00cbe6d-2472-4029-b229-051eac8d5708"],
Cell[38053, 1191, 1011, 30, 60, "Output",ExpressionUUID->"694fd886-8527-470a-845f-001c72c526d0"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[39113, 1227, 179, 3, 56, "Subsubsection",ExpressionUUID->"25a276d9-7071-45a2-94a6-737870ff3a2a"],
Cell[CellGroupData[{
Cell[39317, 1234, 2145, 64, 202, "Input",ExpressionUUID->"95789cf2-b3a8-4236-a2f7-7ad91cf301ca"],
Cell[41465, 1300, 935, 25, 60, "Output",ExpressionUUID->"7cee30a6-7ef1-48e7-bf2b-08ad7774d89c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42437, 1330, 1643, 49, 178, "Input",ExpressionUUID->"9397d29e-88de-45a2-9370-29ca6b5f0755"],
Cell[44083, 1381, 879, 25, 60, "Output",ExpressionUUID->"a1d06fdb-31ff-458b-ac1f-cf81b07cb516"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44999, 1411, 713, 21, 58, "Input",ExpressionUUID->"649b1283-dfdf-456d-aaa6-4cb864aac50f"],
Cell[45715, 1434, 1445, 42, 61, "Output",ExpressionUUID->"ebd6b923-5def-42d2-a546-4ca045cdce92"]
}, Open  ]],
Cell[47175, 1479, 1781, 54, 82, "Input",ExpressionUUID->"9ff32df5-18e9-4591-96a3-684082c8d62e"],
Cell[48959, 1535, 2465, 85, 310, "Text",ExpressionUUID->"c80edfba-11d8-48f3-b987-20a2a7be6704"]
}, Open  ]],
Cell[CellGroupData[{
Cell[51461, 1625, 88, 0, 56, "Subsubsection",ExpressionUUID->"922adf84-55e9-44bf-b558-fe576790fb59"],
Cell[51552, 1627, 485, 10, 187, "Text",ExpressionUUID->"7ca49f58-6c02-4442-ac8c-97d6999ccb5f"],
Cell[52040, 1639, 2253, 57, 531, "Input",ExpressionUUID->"41ed739e-de60-4c01-9084-fbaca9e8bbf8",
 InitializationCell->True],
Cell[54296, 1698, 2078, 69, 322, "Input",ExpressionUUID->"f8246bcc-52a0-41df-8430-7871a1f2a7d1",
 InitializationCell->True],
Cell[56377, 1769, 2121, 50, 347, "Text",ExpressionUUID->"38c6f77c-9986-4c92-804a-ef5f66630fed"],
Cell[58501, 1821, 3682, 92, 511, "Input",ExpressionUUID->"ac6a248a-86fd-4c9d-88d3-e0fe861ffb74"],
Cell[62186, 1915, 3450, 110, 234, "Text",ExpressionUUID->"76e306bd-eb33-4aa7-b7ce-4f4a35dcfe2e"],
Cell[65639, 2027, 2590, 72, 321, "Input",ExpressionUUID->"0a0505f0-ebc6-4d66-9aa8-b2d046ab7f51"],
Cell[68232, 2101, 2624, 79, 419, "Input",ExpressionUUID->"2ccf1027-9be7-45a2-a590-89a0dd585c44"]
}, Open  ]],
Cell[CellGroupData[{
Cell[70893, 2185, 165, 3, 56, "Subsubsection",ExpressionUUID->"2f5948b7-0e8d-418e-8843-e770c4febd93"],
Cell[71061, 2190, 1933, 49, 394, "Code",ExpressionUUID->"4e6847c9-615b-44c3-ac3f-55cccbb48681",
 InitializationCell->False],
Cell[CellGroupData[{
Cell[73019, 2243, 164, 2, 35, "Input",ExpressionUUID->"ffd45a87-332e-428a-9dcb-03b4c91a318f"],
Cell[73186, 2247, 773, 19, 81, "Output",ExpressionUUID->"8baea5b5-731e-4357-8ba6-f638ff50c251"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73996, 2271, 257, 5, 35, "Input",ExpressionUUID->"2eb59408-4900-41a5-a5aa-29628fec1473"],
Cell[74256, 2278, 1047, 23, 81, "Output",ExpressionUUID->"4d83103f-d2dc-4913-85c4-67f6a4009dc8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[75340, 2306, 338, 7, 83, "Input",ExpressionUUID->"e75b2406-c738-4279-9e8b-d47a259379ad"],
Cell[75681, 2315, 1906, 47, 167, "Output",ExpressionUUID->"97ac1c5c-a776-461a-b60e-7daad23d6000"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[77636, 2368, 319, 5, 56, "Subsubsection",ExpressionUUID->"d99b77c7-2099-4130-b7b5-5a06e9aea70f"],
Cell[77958, 2375, 1137, 28, 251, "Input",ExpressionUUID->"7dc12ece-a07c-456b-bbfc-def054b8ca0f"],
Cell[79098, 2405, 836, 21, 203, "Input",ExpressionUUID->"74a84c1c-451a-411f-b792-8367a751640c"],
Cell[79937, 2428, 449, 12, 61, "Input",ExpressionUUID->"633260b7-329b-486a-b87a-426100b500ff"],
Cell[CellGroupData[{
Cell[80411, 2444, 359, 10, 38, "Input",ExpressionUUID->"569aa28d-b70e-494a-8fc0-7a5084271ce4"],
Cell[80773, 2456, 292, 7, 56, "Output",ExpressionUUID->"e2ed6351-3db5-4e57-b26b-83e0b187adac"]
}, Open  ]],
Cell[CellGroupData[{
Cell[81102, 2468, 476, 13, 60, "Input",ExpressionUUID->"b6b08f83-1a62-4cd9-8f46-0c5383920085"],
Cell[81581, 2483, 241, 6, 56, "Output",ExpressionUUID->"e3d3e502-bbd7-488d-99f8-8f972aa1c60c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[81859, 2494, 1433, 38, 226, "Input",ExpressionUUID->"22ca4370-dfb0-4bbf-8923-37d2344cd033"],
Cell[83295, 2534, 620, 17, 98, "Output",ExpressionUUID->"fb2c9726-1954-41de-a712-94bc8362a6a7"]
}, Open  ]],
Cell[83930, 2554, 918, 24, 143, "Text",ExpressionUUID->"48d87327-77fc-4cd6-a461-e04a63534fc5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[84885, 2583, 330, 5, 56, "Subsubsection",ExpressionUUID->"1266da49-16f6-4483-aa84-61f4186807d4"],
Cell[85218, 2590, 3777, 103, 369, "Input",ExpressionUUID->"2d9ce86a-7deb-4a01-8dee-34165de4e2b3"],
Cell[88998, 2695, 1104, 28, 155, "Input",ExpressionUUID->"9d486429-ba24-47d6-9b03-45f9fbe9b27a"],
Cell[90105, 2725, 1782, 52, 278, "Input",ExpressionUUID->"a8d74db2-c016-46e3-a329-5c8c1c62a200"],
Cell[91890, 2779, 4918, 126, 586, "Input",ExpressionUUID->"c3d53937-a5c0-47a2-89f0-234d9f02f8d9"],
Cell[96811, 2907, 672, 16, 107, "Input",ExpressionUUID->"0fd02123-25a7-4886-b834-49c6678afaa7"],
Cell[97486, 2925, 4083, 108, 607, "Input",ExpressionUUID->"08a3b405-2f6b-4600-a727-26cd19579d6f"],
Cell[101572, 3035, 3532, 90, 535, "Input",ExpressionUUID->"57035cdf-1ef4-424d-bc51-d43045853ccd"],
Cell[105107, 3127, 350, 8, 101, "Text",ExpressionUUID->"aedaa600-e98a-41ae-b235-cde23d0448fc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[105494, 3140, 263, 4, 56, "Subsubsection",ExpressionUUID->"00bba445-a1d0-4a9a-b119-3af5ec70b21b"],
Cell[105760, 3146, 1718, 49, 346, "Input",ExpressionUUID->"7445c46f-430d-4723-af28-9e243e46603a"],
Cell[CellGroupData[{
Cell[107503, 3199, 579, 16, 60, "Input",ExpressionUUID->"ccc31021-d748-469b-940a-bd0d25ee16e5"],
Cell[108085, 3217, 704, 19, 120, "Output",ExpressionUUID->"c210b46c-53f1-4b69-8a65-835e14e3dfde"]
}, Open  ]],
Cell[CellGroupData[{
Cell[108826, 3241, 674, 13, 83, "Input",ExpressionUUID->"cc8b1c1e-5c7c-4d95-a786-9574b26231c5"],
Cell[109503, 3256, 812, 19, 120, "Output",ExpressionUUID->"b8440367-3097-40f3-bc74-8f70f1f39ca4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[110352, 3280, 452, 10, 83, "Input",ExpressionUUID->"426ef50a-5d3b-4ae5-ae27-5dbd8c2612dc"],
Cell[110807, 3292, 822, 19, 120, "Output",ExpressionUUID->"dee4b77c-2677-4b26-8a61-6b6c890751c5"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[111678, 3317, 167, 3, 56, "Subsubsection",ExpressionUUID->"2306acda-d04d-4441-83dc-962138ffb0e9"],
Cell[111848, 3322, 2896, 81, 535, "Input",ExpressionUUID->"8eea1146-91ac-4802-a814-6e6014437957"]
}, Open  ]],
Cell[CellGroupData[{
Cell[114781, 3408, 343, 5, 56, "Subsubsection",ExpressionUUID->"3361bc7e-9b5b-42c2-9568-44c3d0999b82"],
Cell[CellGroupData[{
Cell[115149, 3417, 7896, 173, 773, "Input",ExpressionUUID->"8f23b11d-0382-4e5a-a1fb-0aaa715246e2"],
Cell[123048, 3592, 976, 23, 107, "Output",ExpressionUUID->"a841443a-19bb-4ce1-8b13-6fa8c0cf7a2c"]
}, Open  ]],
Cell[124039, 3618, 6438, 138, 488, "Input",ExpressionUUID->"c93b649d-0486-4c56-bace-65c942df531b"],
Cell[CellGroupData[{
Cell[130502, 3760, 4188, 106, 696, "Input",ExpressionUUID->"8879d4a6-fb71-4edc-8d6e-eeecdf518c3e"],
Cell[134693, 3868, 769, 18, 120, "Output",ExpressionUUID->"c4d9adff-ce10-4e04-ba0f-461daf848cc3"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

